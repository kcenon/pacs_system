# 소프트웨어 요구사항 명세서 - PACS System

> **버전:** 0.1.2.0
> **최종 수정:** 2025-12-07
> **언어:** [English](SRS.md) | **한국어**
> **표준:** IEEE 830-1998 기반

---

## 문서 정보

| 항목 | 내용 |
|------|------|
| **문서 ID** | PACS-SRS-001 |
| **프로젝트** | PACS System |
| **작성자** | kcenon@naver.com |
| **상태** | 초안 |
| **관련 문서** | [PRD](PRD_KO.md), [ARCHITECTURE](ARCHITECTURE_KO.md), [API_REFERENCE](API_REFERENCE_KO.md) |

---

## 목차

- [1. 소개](#1-소개)
- [2. 전체 설명](#2-전체-설명)
- [3. 상세 요구사항](#3-상세-요구사항)
- [4. 외부 인터페이스 요구사항](#4-외부-인터페이스-요구사항)
- [5. 시스템 기능](#5-시스템-기능)
- [6. 비기능 요구사항](#6-비기능-요구사항)
- [7. 요구사항 추적 매트릭스](#7-요구사항-추적-매트릭스)
- [8. 부록](#8-부록)

---

## 1. 소개

### 1.1 목적

본 소프트웨어 요구사항 명세서(SRS)는 PACS System의 모든 소프트웨어 요구사항에 대한 완전한 설명을 제공합니다. 이 문서는 이해관계자와 개발팀 간에 소프트웨어 제품이 수행할 기능에 대한 합의의 기초를 확립합니다.

### 1.2 범위

PACS System은 다음을 수행하는 의료 영상 저장 및 통신 플랫폼입니다:
- 외부 DICOM 라이브러리 없이 DICOM 프로토콜을 처음부터 구현
- Storage, Query/Retrieve, Worklist, MPPS 서비스 제공
- kcenon 에코시스템(6개 기존 시스템)과 통합
- Linux, macOS, Windows 플랫폼에서 운영

### 1.3 정의, 약어 및 약자

| 용어 | 정의 |
|------|------|
| **PACS** | Picture Archiving and Communication System (의료 영상 저장 통신 시스템) |
| **DICOM** | Digital Imaging and Communications in Medicine (의료 디지털 영상 통신) |
| **SCP** | Service Class Provider (서비스 제공자 역할) |
| **SCU** | Service Class User (서비스 사용자 역할) |
| **PDU** | Protocol Data Unit (프로토콜 데이터 단위) |
| **DIMSE** | DICOM Message Service Element (DICOM 메시지 서비스 요소) |
| **VR** | Value Representation (값 표현) |
| **SOP** | Service-Object Pair (서비스-객체 쌍) |
| **IOD** | Information Object Definition (정보 객체 정의) |
| **MWL** | Modality Worklist (모달리티 작업 목록) |
| **MPPS** | Modality Performed Procedure Step (모달리티 수행 절차 단계) |
| **AE** | Application Entity (응용 엔티티) |

### 1.4 참조

| 참조 | 설명 |
|------|------|
| DICOM PS3.1-PS3.20 | DICOM 표준 2024 |
| IEEE 830-1998 | IEEE SRS 표준 |
| PRD-PACS-001 | 제품 요구사항 문서 |
| ARCH-PACS-001 | 아키텍처 문서 |

### 1.5 개요

본 문서는 다음과 같이 구성됩니다:
- **섹션 2**: 전체 시스템 설명 및 제약사항
- **섹션 3**: 추적성을 갖춘 상세 기능 요구사항
- **섹션 4**: 외부 인터페이스 요구사항
- **섹션 5**: 시스템 기능 명세
- **섹션 6**: 비기능 요구사항
- **섹션 7**: 요구사항 추적 매트릭스
- **섹션 8**: 부록

---

## 2. 전체 설명

### 2.1 제품 관점

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           PACS 에코시스템                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│    ┌──────────────┐    ┌──────────────┐    ┌──────────────┐             │
│    │   모달리티    │    │   모달리티    │    │   모달리티    │             │
│    │  (CT/MR/CR)  │    │  (CT/MR/CR)  │    │  (CT/MR/CR)  │             │
│    └───────┬──────┘    └───────┬──────┘    └───────┬──────┘             │
│            │                   │                   │                     │
│            └───────────────────┼───────────────────┘                     │
│                                │ DICOM                                   │
│                                ▼                                         │
│    ┌─────────────────────────────────────────────────────────────────┐  │
│    │                        PACS System                               │  │
│    │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐   │  │
│    │  │Storage  │ │ Q/R     │ │Worklist │ │  MPPS   │ │Verify   │   │  │
│    │  │SCP/SCU  │ │SCP/SCU  │ │  SCP    │ │  SCP    │ │SCP/SCU  │   │  │
│    │  └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘   │  │
│    │       └───────────┴───────────┴───────────┴───────────┘         │  │
│    │                              │                                   │  │
│    │  ┌───────────────────────────▼──────────────────────────────┐   │  │
│    │  │                    저장소 백엔드                          │   │  │
│    │  │    파일 저장소    │    인덱스 데이터베이스    │    캐시    │   │  │
│    │  └──────────────────────────────────────────────────────────┘   │  │
│    └─────────────────────────────────────────────────────────────────┘  │
│                                │                                         │
│            ┌───────────────────┼───────────────────┐                     │
│            ▼                   ▼                   ▼                     │
│    ┌──────────────┐    ┌──────────────┐    ┌──────────────┐             │
│    │     뷰어     │    │   HIS/RIS    │    │    아카이브   │             │
│    └──────────────┘    └──────────────┘    └──────────────┘             │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 제품 기능

| 기능 | 설명 |
|------|------|
| **DICOM 저장** | 모달리티로부터 의료 영상 수신 및 저장 |
| **영상 조회** | 환자, 검사, 시리즈, 영상 검색 |
| **영상 전송** | 요청 시스템으로 영상 전송 |
| **모달리티 작업목록** | 예약된 검사 정보 제공 |
| **MPPS 추적** | 수행된 검사 상태 추적 |
| **검증** | DICOM 연결 테스트 |

### 2.3 사용자 클래스 및 특성

| 사용자 클래스 | 특성 | 기술 수준 |
|---------------|------|----------|
| 의료 IT 개발자 | PACS API를 사용하여 응용 프로그램 개발 | 전문가 |
| 시스템 통합자 | 모달리티를 PACS에 연결 | 고급 |
| 시스템 관리자 | PACS 관리 및 모니터링 | 중급 |
| 영상의학과 의사 | PACS 뷰어를 통해 영상 조회 | 기본 |

### 2.4 운영 환경

| 구성요소 | 요구사항 |
|----------|----------|
| **운영체제** | Linux (Ubuntu 22.04+), macOS 14+, Windows 10/11 |
| **컴파일러** | C++20 (GCC 11+, Clang 14+, MSVC 2022+) |
| **메모리** | 최소 4 GB, 권장 16 GB |
| **저장소** | 최소 100 GB, 확장 가능 |
| **네트워크** | 최소 1 Gbps 이더넷 |

### 2.5 설계 및 구현 제약사항

| 제약사항 | 설명 |
|----------|------|
| **C1** | 외부 DICOM 라이브러리 사용 금지 (DCMTK, GDCM 등) |
| **C2** | kcenon 에코시스템 컴포넌트 사용 필수 |
| **C3** | 크로스 플랫폼 호환성 필수 |
| **C4** | 지원되는 SOP 클래스에 대한 DICOM 적합성 필수 |
| **C5** | BSD 3-Clause 라이선스 호환성 |

### 2.6 가정 및 의존성

| ID | 가정/의존성 |
|----|------------|
| **A1** | container_system이 안정적인 바이너리 직렬화 제공 |
| **A2** | network_system TCP 레이어가 연결 관리 처리 |
| **A3** | thread_system이 lock-free 큐 구현 제공 |
| **A4** | DICOM 표준 PS3.x 사양이 안정적 |
| **D1** | common_system v1.0+ 사용 가능 |
| **D2** | container_system v1.0+ 사용 가능 |
| **D3** | network_system v1.0+ 사용 가능 |
| **D4** | thread_system v1.0+ 사용 가능 |
| **D5** | logger_system v1.0+ 사용 가능 |
| **D6** | monitoring_system v1.0+ 사용 가능 |

---

## 3. 상세 요구사항

### 3.1 DICOM 코어 모듈 요구사항

#### SRS-CORE-001: DICOM 태그 구조
| 속성 | 값 |
|------|-----|
| **ID** | SRS-CORE-001 |
| **제목** | DICOM 태그 표현 |
| **설명** | 시스템은 DICOM 태그를 16비트 그룹 번호와 16비트 요소 번호로 구성된 32비트 값으로 표현해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 1 |
| **추적 대상** | FR-1.1.1 |

**인수 조건:**
1. 태그 구조는 메모리 효율적이어야 함 (4바이트)
2. 그룹 및 요소 추출은 O(1)이어야 함
3. 태그 비교는 표준 정렬을 지원해야 함

---

#### SRS-CORE-002: 값 표현 타입
| 속성 | 값 |
|------|-----|
| **ID** | SRS-CORE-002 |
| **제목** | VR 타입 시스템 |
| **설명** | 시스템은 PS3.5에 정의된 모든 27개 DICOM Value Representation 타입을 구현해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 1 |
| **추적 대상** | FR-1.1.2 |

**인수 조건:**
1. 모든 27개 VR 타입 구현
2. 값 내용에 대한 VR 유효성 검사
3. VR별 길이 제약 적용

**VR 타입과 container_system 매핑:**

| VR | 범주 | container_system 타입 | 유효성 검사 |
|----|------|----------------------|-------------|
| AE | 문자열 | string | 최대 16자, 백슬래시 불가 |
| AS | 문자열 | string | 4자, nnnD/W/M/Y 형식 |
| AT | 바이너리 | uint32 | 태그 형식 |
| CS | 문자열 | string | 최대 16자, 대문자 |
| DA | 문자열 | string | YYYYMMDD 형식 |
| DS | 문자열 | string | 십진수 형식, 최대 16자 |
| DT | 문자열 | string | YYYYMMDDHHMMSS.FFFFFF 형식 |
| FL | 숫자 | float | 4바이트 IEEE 754 |
| FD | 숫자 | double | 8바이트 IEEE 754 |
| IS | 문자열 | string | 정수 형식, 최대 12자 |
| LO | 문자열 | string | 최대 64자 |
| LT | 문자열 | string | 최대 10240자 |
| OB | 바이너리 | bytes | 가변 길이 |
| OD | 바이너리 | bytes | 가변 길이, 8바이트 정렬 |
| OF | 바이너리 | bytes | 가변 길이, 4바이트 정렬 |
| OL | 바이너리 | bytes | 가변 길이, 4바이트 정렬 |
| OW | 바이너리 | bytes | 가변 길이, 2바이트 정렬 |
| PN | 문자열 | string | 최대 64자, 컴포넌트 그룹 |
| SH | 문자열 | string | 최대 16자 |
| SL | 숫자 | int32 | 4바이트 부호 있는 |
| SQ | 시퀀스 | container | 중첩 구조 |
| SS | 숫자 | int16 | 2바이트 부호 있는 |
| ST | 문자열 | string | 최대 1024자 |
| TM | 문자열 | string | HHMMSS.FFFFFF 형식 |
| UC | 문자열 | string | 무제한 길이 |
| UI | 문자열 | string | UID 형식, 최대 64자 |
| UL | 숫자 | uint32 | 4바이트 부호 없는 |
| UN | 바이너리 | bytes | 알 수 없는 VR |
| UR | 문자열 | string | URI 형식 |
| US | 숫자 | uint16 | 2바이트 부호 없는 |
| UT | 문자열 | string | 무제한 길이 |

---

#### SRS-CORE-003: 데이터 요소 구조
| 속성 | 값 |
|------|-----|
| **ID** | SRS-CORE-003 |
| **제목** | DICOM 데이터 요소 |
| **설명** | 시스템은 명시적 및 암시적 VR 인코딩을 모두 지원하는 태그, VR, 길이, 값 구성요소로 데이터 요소를 표현해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 1 |
| **추적 대상** | FR-1.1.1, FR-1.3.3, FR-1.3.4 |

**인수 조건:**
1. 2바이트 또는 4바이트 길이 필드가 있는 명시적 VR 인코딩 지원
2. 4바이트 길이 필드가 있는 암시적 VR 인코딩 지원
3. 시퀀스에 대한 미정의 길이 인코딩 처리
4. 값 다중성(VM) 지원

---

#### SRS-CORE-004: 시퀀스 요소 처리
| 속성 | 값 |
|------|-----|
| **ID** | SRS-CORE-004 |
| **제목** | 중첩 시퀀스 지원 |
| **설명** | 시스템은 구분 항목이 있는 미정의 길이 시퀀스를 포함하여 무제한 깊이의 중첩 시퀀스(SQ) 요소를 지원해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 1 |
| **추적 대상** | FR-1.1.3 |

**인수 조건:**
1. 정의된 길이의 시퀀스 파싱
2. 미정의 길이(0xFFFFFFFF)의 시퀀스 파싱
3. Item 및 Item Delimitation 태그 올바르게 처리
4. 중첩 시퀀스(SQ 내 SQ) 지원

---

#### SRS-CORE-005: 데이터 셋 컨테이너
| 속성 | 값 |
|------|-----|
| **ID** | SRS-CORE-005 |
| **제목** | DICOM 데이터 셋 연산 |
| **설명** | 시스템은 요소를 태그 순서로 유지하고 효율적인 조회, 삽입, 반복을 지원하는 데이터 셋 컨테이너를 제공해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 1 |
| **추적 대상** | FR-1.2.1, FR-1.2.2, FR-1.2.3, FR-1.2.4 |

**인수 조건:**
1. 요소가 태그 오름차순으로 저장
2. O(log n) 태그별 요소 조회
3. O(n) 태그 순서 반복
4. 깊은 복사 및 이동 의미론
5. 요소 삽입 시 순서 유지

**필수 연산:**

| 연산 | 복잡도 | 설명 |
|------|--------|------|
| `get(tag)` | O(log n) | 태그로 요소 가져오기 |
| `set(element)` | O(log n) | 요소 삽입 또는 업데이트 |
| `remove(tag)` | O(log n) | 태그로 요소 제거 |
| `contains(tag)` | O(log n) | 요소 존재 확인 |
| `iterate()` | O(n) | 태그 순서로 반복 |
| `size()` | O(1) | 요소 수 |
| `clear()` | O(n) | 모든 요소 제거 |
| `copy()` | O(n) | 깊은 복사 |
| `move()` | O(1) | 이동 의미론 |

---

#### SRS-CORE-006: DICOM 파일 형식 (Part 10)
| 속성 | 값 |
|------|-----|
| **ID** | SRS-CORE-006 |
| **제목** | DICOM 파일 읽기/쓰기 |
| **설명** | 시스템은 128바이트 프리앰블, "DICM" 접두사, 파일 메타 정보를 포함하여 PS3.10을 준수하는 DICOM 파일을 읽고 써야 합니다. |
| **우선순위** | Must Have |
| **단계** | 1 |
| **추적 대상** | FR-1.3.1, FR-1.3.2 |

**인수 조건:**
1. 유효한 DICM 접두사가 있는 파일 읽기
2. 파일 메타 정보(그룹 0002) 파싱
3. Transfer Syntax 감지 및 유효성 검사
4. 적절한 파일 메타 정보로 파일 쓰기
5. 대용량 파일에 대한 스트리밍 지원

---

#### SRS-CORE-007: Transfer Syntax 인코딩
| 속성 | 값 |
|------|-----|
| **ID** | SRS-CORE-007 |
| **제목** | Transfer Syntax 지원 |
| **설명** | 시스템은 Implicit VR Little Endian, Explicit VR Little Endian, Explicit VR Big Endian transfer syntax에 따라 데이터 인코딩 및 디코딩을 지원해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 1 |
| **추적 대상** | FR-1.3.3, FR-1.3.4, FR-1.3.5, FR-1.3.6 |

**인수 조건:**
1. 파일 메타 정보에서 transfer syntax 감지
2. Implicit VR Little Endian (1.2.840.10008.1.2) 인코딩/디코딩
3. Explicit VR Little Endian (1.2.840.10008.1.2.1) 인코딩/디코딩
4. Explicit VR Big Endian (1.2.840.10008.1.2.2) 인코딩/디코딩
5. VR 길이 필드 크기 유효성 검사

---

#### SRS-CORE-008: 태그 사전
| 속성 | 값 |
|------|-----|
| **ID** | SRS-CORE-008 |
| **제목** | DICOM 태그 사전 |
| **설명** | 시스템은 키워드, VR, VM, 폐기 상태를 포함하여 PS3.6의 모든 표준 DICOM 태그가 있는 컴파일 타임 태그 사전을 제공해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 1 |
| **추적 대상** | FR-1.1.2 |

**인수 조건:**
1. PS3.6의 모든 표준 태그 정의
2. 컴파일 타임 상수 태그
3. 태그-키워드 조회
4. 키워드-태그 조회
5. VR 유효성 검사 지원

---

### 3.2 네트워크 프로토콜 요구사항

#### SRS-NET-001: PDU 타입 지원
| 속성 | 값 |
|------|-----|
| **ID** | SRS-NET-001 |
| **제목** | Protocol Data Unit 구현 |
| **설명** | 시스템은 연결 설정, 데이터 전송, 해제를 위한 모든 DICOM Upper Layer PDU 타입을 구현해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 2 |
| **추적 대상** | FR-2.1.1 - FR-2.1.7 |

**인수 조건:**
1. A-ASSOCIATE-RQ (0x01) 인코딩/디코딩 구현
2. A-ASSOCIATE-AC (0x02) 인코딩/디코딩 구현
3. A-ASSOCIATE-RJ (0x03) 인코딩/디코딩 구현
4. P-DATA-TF (0x04) 인코딩/디코딩 구현
5. A-RELEASE-RQ (0x05) 인코딩/디코딩 구현
6. A-RELEASE-RP (0x06) 인코딩/디코딩 구현
7. A-ABORT (0x07) 인코딩/디코딩 구현
8. PDU 프래그먼트 재조립 처리

---

#### SRS-NET-002: Association 상태 머신
| 속성 | 값 |
|------|-----|
| **ID** | SRS-NET-002 |
| **제목** | Association 상태 관리 |
| **설명** | 시스템은 PS3.8에 정의된 모든 13개 상태와 유효한 상태 전환을 갖춘 DICOM Association 상태 머신을 구현해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 2 |
| **추적 대상** | FR-2.2.1 |

**인수 조건:**
1. 모든 13개 상태 구현
2. 상태 전환 유효성 검사
3. 각 상태에서 타임아웃 처리
4. 디버깅을 위한 상태 변경 로깅

---

#### SRS-NET-003: Presentation Context 협상
| 속성 | 값 |
|------|-----|
| **ID** | SRS-NET-003 |
| **제목** | Presentation Context 관리 |
| **설명** | 시스템은 association당 여러 abstract syntax와 transfer syntax를 지원하는 presentation context를 협상해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 2 |
| **추적 대상** | FR-2.2.2 |

**인수 조건:**
1. association당 최대 128개 presentation context 지원
2. 각 abstract syntax에 대한 transfer syntax 협상
3. 수락/거부된 context 추적
4. 각 DIMSE 작업에 적절한 context 선택

---

#### SRS-NET-004: DIMSE 메시지 처리
| 속성 | 값 |
|------|-----|
| **ID** | SRS-NET-004 |
| **제목** | DIMSE 명령 및 데이터 처리 |
| **설명** | 시스템은 모든 C-xxx 및 N-xxx 메시지 타입을 지원하는 DIMSE 명령 및 데이터 셋을 인코딩하고 디코딩해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 2 |
| **추적 대상** | FR-2.3.1 - FR-2.3.9 |

**인수 조건:**
1. 명령 요소로 DIMSE 명령 인코딩
2. DIMSE 명령 디코딩 및 필드 추출
3. 명령/데이터 프래그먼테이션 처리
4. C-FIND/C-MOVE에 대한 보류 응답 지원

---

#### SRS-NET-005: 동시 Association 지원
| 속성 | 값 |
|------|-----|
| **ID** | SRS-NET-005 |
| **제목** | 다중 동시 Association |
| **설명** | 시스템은 구성 가능한 제한으로 여러 동시 association을 지원하고 처리를 위해 스레드 풀을 사용해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 2 |
| **추적 대상** | FR-2.2.3, NFR-1.2 |

**인수 조건:**
1. 100개 이상의 동시 association 지원
2. 구성 가능한 최대 association 제한
3. association별 독립적인 상태 머신
4. 공정한 리소스 할당

---

### 3.3 DICOM 서비스 요구사항

#### SRS-SVC-001: 검증 서비스
| 속성 | 값 |
|------|-----|
| **ID** | SRS-SVC-001 |
| **제목** | C-ECHO 구현 |
| **설명** | 시스템은 C-ECHO를 사용한 연결 테스트를 위해 Verification SCP 및 SCU 역할을 구현해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 2 |
| **추적 대상** | FR-3.1.1, FR-3.1.2, FR-3.1.3 |

**인수 조건:**
1. SCP가 C-ECHO-RQ에 C-ECHO-RSP(상태 0x0000)로 응답
2. SCU가 C-ECHO를 시작하고 응답 유효성 검사
3. 허용된 모든 association 상태에서 C-ECHO 작동

---

#### SRS-SVC-002: Storage SCP
| 속성 | 값 |
|------|-----|
| **ID** | SRS-SVC-002 |
| **제목** | Storage Service Class Provider |
| **설명** | 시스템은 CT, MR, CR, DX, Secondary Capture SOP 클래스를 지원하여 C-STORE를 통해 DICOM 복합 객체를 수락하고 저장해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 3 |
| **추적 대상** | FR-3.2.1 - FR-3.2.4 |

**인수 조건:**
1. 지원되는 SOP 클래스에 대한 C-STORE-RQ 수락
2. 수신된 데이터셋 유효성 검사
3. 구성된 저장소 백엔드에 저장
4. 적절한 상태 코드 반환
5. 중복 SOP 인스턴스 감지 처리

---

#### SRS-SVC-003: Storage SCU
| 속성 | 값 |
|------|-----|
| **ID** | SRS-SVC-003 |
| **제목** | Storage Service Class User |
| **설명** | 시스템은 진행 상황 추적 및 재시도 지원으로 C-STORE를 통해 원격 SCP에 DICOM 복합 객체를 전송해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 3 |
| **추적 대상** | FR-3.2.5 |

**인수 조건:**
1. 적절한 presentation context로 C-STORE-RQ 시작
2. PDU 크기 제한에 따라 대용량 데이터셋 분할
3. C-STORE-RSP 상태 코드 처리
4. 전송 중 취소 지원
5. 진행 콜백 제공

---

#### SRS-SVC-004: Query 서비스 (C-FIND)
| 속성 | 값 |
|------|-----|
| **ID** | SRS-SVC-004 |
| **제목** | Query/Retrieve Find SCP/SCU |
| **설명** | 시스템은 Patient, Study, Series, Image 레벨에서 Patient Root 및 Study Root Query/Retrieve 정보 모델을 지원해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 3 |
| **추적 대상** | FR-3.3.1 - FR-3.3.6 |

**인수 조건:**
1. 와일드카드 매칭 지원 (* 및 ?)
2. 날짜에 대한 범위 매칭 지원
3. 적절한 경우 대소문자 구분 없는 매칭 지원
4. 보류 응답으로 일치하는 결과 반환
5. 상태와 함께 최종 응답 반환

---

#### SRS-SVC-005: Retrieve 서비스 (C-MOVE/C-GET)
| 속성 | 값 |
|------|-----|
| **ID** | SRS-SVC-005 |
| **제목** | Query/Retrieve Move/Get SCP/SCU |
| **설명** | 시스템은 C-MOVE(제3자에게) 및 C-GET(요청자에게 직접) 작업을 통한 영상 검색을 지원해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 3 |
| **추적 대상** | FR-3.3.7, FR-3.3.8 |

**인수 조건:**
1. Move Destination AE가 있는 C-MOVE-RQ 파싱
2. C-MOVE를 위해 대상에 하위 association 설정
3. 동일한 association에서 C-GET 처리
4. 진행 상황 추적 및 보고(남음, 완료, 실패, 경고)
5. 취소 지원

---

#### SRS-SVC-006: Modality Worklist SCP
| 속성 | 값 |
|------|-----|
| **ID** | SRS-SVC-006 |
| **제목** | Modality Worklist 서비스 |
| **설명** | 시스템은 Modality Worklist 정보 모델에서 C-FIND를 통해 모달리티에 예약된 검사 단계 정보를 제공해야 합니다. |
| **우선순위** | Should Have |
| **단계** | 4 |
| **추적 대상** | FR-3.4.1 - FR-3.4.3 |

**인수 조건:**
1. Scheduled Procedure Step 매칭 지원
2. 환자, 방문, 검사 정보 반환
3. 날짜/시간 범위 쿼리 지원
4. Modality 필터링 지원

---

#### SRS-SVC-007: MPPS SCP
| 속성 | 값 |
|------|-----|
| **ID** | SRS-SVC-007 |
| **제목** | Modality Performed Procedure Step 서비스 |
| **설명** | 시스템은 MPPS SOP 인스턴스에서 N-CREATE 및 N-SET 작업을 통해 수행된 검사 상태를 추적해야 합니다. |
| **우선순위** | Should Have |
| **단계** | 4 |
| **추적 대상** | FR-3.5.1 - FR-3.5.4 |

**인수 조건:**
1. MPPS 초기 상태(IN PROGRESS)로 N-CREATE 수락
2. MPPS 상태 업데이트를 위한 N-SET 수락
3. 상태 전환 유효성 검사(IN PROGRESS → COMPLETED/DISCONTINUED)
4. MPPS 정보 영구 저장

---

### 3.4 저장소 백엔드 요구사항

#### SRS-STOR-001: 파일 시스템 저장소
| 속성 | 값 |
|------|-----|
| **ID** | SRS-STOR-001 |
| **제목** | 계층적 파일 저장소 |
| **설명** | 시스템은 원자적 쓰기 작업으로 구성 가능한 계층적 디렉토리 구조에 DICOM 파일을 저장해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 3 |
| **추적 대상** | FR-4.1.1 - FR-4.1.4 |

**인수 조건:**
1. 구성 가능한 디렉토리 구조(Patient/Study/Series/Instance)
2. 원자적 파일 쓰기(임시에 쓰고 이름 변경)
3. 경로 길이 제한 처리
4. 구성 가능한 파일 명명 지원

---

#### SRS-STOR-002: 인덱스 데이터베이스
| 속성 | 값 |
|------|-----|
| **ID** | SRS-STOR-002 |
| **제목** | DICOM 인덱스 데이터베이스 |
| **설명** | 시스템은 Patient/Study/Series/Instance 계층에서 빠른 쿼리 작업을 위한 인덱스 데이터베이스를 유지해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 3 |
| **추적 대상** | FR-4.2.1 - FR-4.2.4 |

**인수 조건:**
1. 모든 표준 쿼리 키 인덱싱
2. 동시 읽기 작업 지원
3. 참조 무결성 유지
4. 10K 검사에 대해 쿼리 응답 < 100ms

---

### 3.5 통합 요구사항

#### SRS-INT-001: common_system 통합
| 속성 | 값 |
|------|-----|
| **ID** | SRS-INT-001 |
| **제목** | common_system 기반 통합 |
| **설명** | 시스템은 오류 처리를 위해 common_system Result<T>를 사용하고 비동기 작업을 위해 IExecutor를 사용해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 1 |
| **추적 대상** | IR-1 |

**인수 조건:**
1. 모든 실패 가능 작업이 Result<T> 반환
2. -800 ~ -899 범위의 오류 코드
3. 비동기 작업 제출을 위한 IExecutor

---

#### SRS-INT-002: container_system 통합
| 속성 | 값 |
|------|-----|
| **ID** | SRS-INT-002 |
| **제목** | container_system 데이터 직렬화 |
| **설명** | 시스템은 DICOM 데이터 표현을 위해 container_system 값 타입 및 바이너리 직렬화를 사용해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 1 |
| **추적 대상** | IR-1 |

**인수 조건:**
1. DICOM VR을 container_system 타입에 매핑
2. DICOM 파일 I/O에 바이너리 직렬화 사용
3. 픽셀 데이터 처리에 SIMD 활용

---

#### SRS-INT-003: network_system 통합
| 속성 | 값 |
|------|-----|
| **ID** | SRS-INT-003 |
| **제목** | network_system 네트워크 레이어 |
| **설명** | 시스템은 TCP 연결 관리 및 TLS 지원을 위해 network_system을 사용해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 2 |
| **추적 대상** | IR-1 |

**인수 조건:**
1. SCP 기반으로 messaging_server
2. SCU 기반으로 messaging_client
3. Association 래퍼로 messaging_session
4. DICOM TLS를 위한 TLS 1.2+

---

#### SRS-INT-004: thread_system 통합
| 속성 | 값 |
|------|-----|
| **ID** | SRS-INT-004 |
| **제목** | thread_system 동시성 |
| **설명** | 시스템은 동시 DIMSE 처리 및 저장 작업을 위해 thread_system 작업자 풀을 사용해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 2 |
| **추적 대상** | IR-1 |

**인수 조건:**
1. DIMSE 처리를 위한 작업자 풀
2. 작업 배포를 위한 lock-free 큐
3. 취소 토큰 지원

---

#### SRS-INT-005: logger_system 통합
| 속성 | 값 |
|------|-----|
| **ID** | SRS-INT-005 |
| **제목** | logger_system 감사 로깅 |
| **설명** | 시스템은 HIPAA 준수를 위해 PHI 액세스 추적이 있는 감사 로그를 위해 logger_system을 사용해야 합니다. |
| **우선순위** | Must Have |
| **단계** | 3 |
| **추적 대상** | IR-1, NFR-4.2, NFR-4.3 |

**인수 조건:**
1. 모든 DICOM 작업 로깅
2. 사용자 ID와 함께 PHI 액세스 로깅
3. 성능을 위한 비동기 로깅
4. 회전 로그 파일

---

#### SRS-INT-006: monitoring_system 통합
| 속성 | 값 |
|------|-----|
| **ID** | SRS-INT-006 |
| **제목** | monitoring_system 관측성 |
| **설명** | 시스템은 성능 메트릭, 상태 확인, 분산 트레이싱을 위해 monitoring_system을 사용해야 합니다. |
| **우선순위** | Should Have |
| **단계** | 3 |
| **추적 대상** | IR-1 |

**인수 조건:**
1. DICOM 작업 메트릭(횟수, 지연시간, 처리량)
2. 상태 확인 엔드포인트
3. 저장소 사용량 메트릭

---

## 4. 외부 인터페이스 요구사항

### 4.1 사용자 인터페이스

PACS System은 직접적인 사용자 인터페이스를 제공하지 않습니다. 모든 상호작용은 다음을 통해 이루어집니다:
- DICOM 네트워크 프로토콜
- 구성 파일
- 관리 CLI 도구(향후)

### 4.2 하드웨어 인터페이스

| 인터페이스 | 설명 |
|------------|------|
| 네트워크 | 1 Gbps 이더넷 이상 |
| 저장소 | 로컬 파일 시스템 또는 네트워크 저장소(NFS, CIFS) |
| 메모리 | 최소 4 GB, 권장 16 GB |

### 4.3 소프트웨어 인터페이스

| 인터페이스 | 프로토콜 | 설명 |
|------------|----------|------|
| 모달리티 | DICOM | CT, MR, CR, DX 스캐너 |
| 뷰어 | DICOM | 영상 조회 워크스테이션 |
| HIS/RIS | HL7(향후) | 병원/영상의학 정보 시스템 |
| 아카이브 | DICOM/WADO | 장기 저장 시스템 |

### 4.4 통신 인터페이스

| 프로토콜 | 포트 | 설명 |
|----------|------|------|
| DICOM | 104, 11112 | 표준 DICOM 포트 |
| DICOM TLS | 2762 | 보안 DICOM |
| HTTP(향후) | 8080 | WADO-RS/DICOMweb |

---

## 5. 시스템 기능

### 5.1 기능: DICOM 영상 저장

**설명:** 모달리티로부터 의료 영상 수신 및 저장.

| 속성 | 값 |
|------|-----|
| **우선순위** | Must Have |
| **단계** | 3 |
| **SRS 요구사항** | SRS-SVC-002, SRS-STOR-001, SRS-STOR-002 |
| **PRD 요구사항** | FR-3.2.1-FR-3.2.5, FR-4.1.1-FR-4.1.4 |

**사용 사례:**
1. 모달리티가 PACS와 association 시작
2. PACS가 association 수락 및 presentation context 협상
3. 모달리티가 영상 데이터와 함께 C-STORE 전송
4. PACS가 영상 유효성 검사 및 저장
5. PACS가 성공 상태 반환
6. Association 해제

---

### 5.2 기능: 영상 조회

**설명:** 환자, 검사, 시리즈, 영상 검색.

| 속성 | 값 |
|------|-----|
| **우선순위** | Must Have |
| **단계** | 3 |
| **SRS 요구사항** | SRS-SVC-004, SRS-STOR-002 |
| **PRD 요구사항** | FR-3.3.1-FR-3.3.6, FR-4.2.1-FR-4.2.4 |

**사용 사례:**
1. 뷰어가 PACS와 association 시작
2. 뷰어가 쿼리 조건과 함께 C-FIND 전송
3. PACS가 인덱스 데이터베이스 검색
4. PACS가 일치하는 결과 반환(보류 응답)
5. PACS가 최종 응답 반환
6. Association 해제

---

### 5.3 기능: 영상 검색

**설명:** 요청 시스템으로 영상 전송.

| 속성 | 값 |
|------|-----|
| **우선순위** | Must Have |
| **단계** | 3 |
| **SRS 요구사항** | SRS-SVC-005 |
| **PRD 요구사항** | FR-3.3.7, FR-3.3.8 |

**사용 사례(C-MOVE):**
1. 뷰어가 PACS와 association 시작
2. 뷰어가 대상 AE와 함께 C-MOVE 전송
3. PACS가 대상과 association 설정
4. PACS가 C-STORE를 통해 영상 전송
5. PACS가 뷰어에게 진행 상황 보고
6. Association 해제

---

### 5.4 기능: Modality Worklist

**설명:** 예약된 검사 정보 제공.

| 속성 | 값 |
|------|-----|
| **우선순위** | Should Have |
| **단계** | 4 |
| **SRS 요구사항** | SRS-SVC-006 |
| **PRD 요구사항** | FR-3.4.1-FR-3.4.3 |

**사용 사례:**
1. 모달리티가 PACS와 association 시작
2. 모달리티가 MWL 쿼리와 함께 C-FIND 전송
3. PACS가 예약된 검사 반환
4. 모달리티가 작업 목록 표시
5. Association 해제

---

### 5.5 기능: MPPS 추적

**설명:** 수행된 검사 상태 추적.

| 속성 | 값 |
|------|-----|
| **우선순위** | Should Have |
| **단계** | 4 |
| **SRS 요구사항** | SRS-SVC-007 |
| **PRD 요구사항** | FR-3.5.1-FR-3.5.4 |

**사용 사례:**
1. 모달리티가 PACS와 association 시작
2. 모달리티가 N-CREATE(IN PROGRESS) 전송
3. 검사 수행
4. 모달리티가 N-SET(COMPLETED) 전송
5. Association 해제

---

## 6. 비기능 요구사항

### 6.1 성능 요구사항

| ID | 요구사항 | 목표 | 추적 대상 |
|----|----------|------|-----------|
| SRS-PERF-001 | 영상 저장 처리량 | ≥100 MB/s | NFR-1.1 |
| SRS-PERF-002 | 동시 association | ≥100 | NFR-1.2 |
| SRS-PERF-003 | 쿼리 응답 시간 (P95) | <100 ms | NFR-1.3 |
| SRS-PERF-004 | Association 설정 | <50 ms | NFR-1.4 |
| SRS-PERF-005 | 기본 메모리 사용량 | <500 MB | NFR-1.5 |
| SRS-PERF-006 | Association당 메모리 | <10 MB | NFR-1.6 |

### 6.2 신뢰성 요구사항

| ID | 요구사항 | 목표 | 추적 대상 |
|----|----------|------|-----------|
| SRS-REL-001 | 시스템 가용성 | 99.9% | NFR-2.1 |
| SRS-REL-002 | 데이터 무결성 | 100% | NFR-2.2 |
| SRS-REL-003 | 점진적 성능 저하 | 고부하 시 | NFR-2.3 |
| SRS-REL-004 | 오류 복구 | 자동 | NFR-2.4 |
| SRS-REL-005 | 트랜잭션 안전성 | ACID | NFR-2.5 |

### 6.3 보안 요구사항

| ID | 요구사항 | 목표 | 추적 대상 |
|----|----------|------|-----------|
| SRS-SEC-001 | TLS 지원 | TLS 1.2/1.3 | NFR-4.1, SR-1 |
| SRS-SEC-002 | 액세스 로깅 | 완전 | NFR-4.2 |
| SRS-SEC-003 | 감사 추적 | HIPAA 준수 | NFR-4.3, SR-2 |
| SRS-SEC-004 | 입력 유효성 검사 | 100% | NFR-4.4 |
| SRS-SEC-005 | 메모리 안전성 | 누수 없음 | NFR-4.5 |

### 6.4 유지보수성 요구사항

| ID | 요구사항 | 목표 | 추적 대상 |
|----|----------|------|-----------|
| SRS-MAINT-001 | 코드 커버리지 | ≥80% | NFR-5.1 |
| SRS-MAINT-002 | 문서화 | 완전 | NFR-5.2 |
| SRS-MAINT-003 | CI/CD 파이프라인 | 100% 그린 | NFR-5.3 |
| SRS-MAINT-004 | 스레드 안전성 | 검증됨 | NFR-5.4 |
| SRS-MAINT-005 | 모듈식 설계 | 낮은 결합도 | NFR-5.5 |

---

## 7. 요구사항 추적 매트릭스

### 7.1 PRD에서 SRS로의 추적

| PRD 요구사항 | SRS 요구사항 | 상태 |
|-------------|--------------|------|
| FR-1.1.1 | SRS-CORE-001, SRS-CORE-003 | 명세됨 |
| FR-1.1.2 | SRS-CORE-002, SRS-CORE-008 | 명세됨 |
| FR-1.1.3 | SRS-CORE-004 | 명세됨 |
| FR-1.2.1-FR-1.2.4 | SRS-CORE-005 | 명세됨 |
| FR-1.3.1-FR-1.3.6 | SRS-CORE-006, SRS-CORE-007 | 명세됨 |
| FR-2.1.1-FR-2.1.7 | SRS-NET-001 | 명세됨 |
| FR-2.2.1-FR-2.2.4 | SRS-NET-002, SRS-NET-003, SRS-NET-005 | 명세됨 |
| FR-2.3.1-FR-2.3.9 | SRS-NET-004 | 명세됨 |
| FR-3.1.1-FR-3.1.3 | SRS-SVC-001 | 명세됨 |
| FR-3.2.1-FR-3.2.5 | SRS-SVC-002, SRS-SVC-003 | 명세됨 |
| FR-3.3.1-FR-3.3.8 | SRS-SVC-004, SRS-SVC-005 | 명세됨 |
| FR-3.4.1-FR-3.4.3 | SRS-SVC-006 | 명세됨 |
| FR-3.5.1-FR-3.5.4 | SRS-SVC-007 | 명세됨 |
| FR-4.1.1-FR-4.1.4 | SRS-STOR-001 | 명세됨 |
| FR-4.2.1-FR-4.2.4 | SRS-STOR-002 | 명세됨 |
| NFR-1.1-NFR-1.6 | SRS-PERF-001 - SRS-PERF-006 | 명세됨 |
| NFR-2.1-NFR-2.5 | SRS-REL-001 - SRS-REL-005 | 명세됨 |
| NFR-4.1-NFR-4.5 | SRS-SEC-001 - SRS-SEC-005 | 명세됨 |
| NFR-5.1-NFR-5.5 | SRS-MAINT-001 - SRS-MAINT-005 | 명세됨 |
| IR-1 | SRS-INT-001 - SRS-INT-006 | 명세됨 |

### 7.2 SRS에서 테스트 케이스로의 추적(템플릿)

| SRS 요구사항 | 테스트 케이스 ID | 테스트 유형 | 상태 |
|-------------|-----------------|-------------|------|
| SRS-CORE-001 | TC-CORE-001 | 단위 | 계획됨 |
| SRS-CORE-002 | TC-CORE-002 | 단위 | 계획됨 |
| SRS-NET-001 | TC-NET-001 | 통합 | 계획됨 |
| SRS-SVC-001 | TC-SVC-001 | 적합성 | 계획됨 |
| SRS-STOR-001 | TC-STOR-001 | 통합 | 계획됨 |

### 7.3 상호 참조 요약

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    요구사항 추적성 개요                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   PRD                    SRS                      테스트 케이스          │
│   ───                    ───                      ──────────             │
│                                                                          │
│   FR-1.x  ────────────►  SRS-CORE-xxx  ────────►  TC-CORE-xxx           │
│   (DICOM 코어)           (코어 모듈)               (단위 테스트)          │
│                                                                          │
│   FR-2.x  ────────────►  SRS-NET-xxx   ────────►  TC-NET-xxx            │
│   (네트워크)             (네트워크 모듈)           (통합)                 │
│                                                                          │
│   FR-3.x  ────────────►  SRS-SVC-xxx   ────────►  TC-SVC-xxx            │
│   (서비스)               (서비스 모듈)             (적합성)               │
│                                                                          │
│   FR-4.x  ────────────►  SRS-STOR-xxx  ────────►  TC-STOR-xxx           │
│   (저장소)               (저장소 모듈)             (통합)                 │
│                                                                          │
│   NFR-x   ────────────►  SRS-PERF-xxx  ────────►  TC-PERF-xxx           │
│   (성능)                 SRS-REL-xxx              (성능)                 │
│                          SRS-SEC-xxx              (부하 테스트)           │
│                          SRS-MAINT-xxx                                   │
│                                                                          │
│   IR-x    ────────────►  SRS-INT-xxx   ────────►  TC-INT-xxx            │
│   (통합)                 (통합)                   (통합)                  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 8. 부록

### 부록 A: 요구사항 ID 체계

| 접두사 | 범주 | 예시 |
|--------|------|------|
| SRS-CORE-xxx | 코어 DICOM 모듈 | SRS-CORE-001 |
| SRS-NET-xxx | 네트워크 프로토콜 | SRS-NET-001 |
| SRS-SVC-xxx | DICOM 서비스 | SRS-SVC-001 |
| SRS-STOR-xxx | 저장소 백엔드 | SRS-STOR-001 |
| SRS-INT-xxx | 통합 | SRS-INT-001 |
| SRS-PERF-xxx | 성능 | SRS-PERF-001 |
| SRS-REL-xxx | 신뢰성 | SRS-REL-001 |
| SRS-SEC-xxx | 보안 | SRS-SEC-001 |
| SRS-MAINT-xxx | 유지보수성 | SRS-MAINT-001 |

### 부록 B: 개정 이력

| 버전 | 날짜 | 작성자 | 변경 사항 |
|------|------|--------|----------|
| 1.0.0 | 2025-11-30 | kcenon | 초기 버전 |

### 부록 C: 용어집

| 용어 | 정의 |
|------|------|
| Association | 두 DICOM Application Entity 간의 논리적 연결 |
| Command Set | DIMSE 명령 정보를 포함하는 DICOM 데이터 셋 |
| Data Set | DICOM 데이터 요소의 모음 |
| Presentation Context | Abstract Syntax와 Transfer Syntax에 대한 합의 |
| Transfer Syntax | DICOM 데이터 인코딩 규칙 |

---

*문서 버전: 0.1.0.0*
*작성일: 2025-11-30*
*작성자: kcenon@naver.com*
