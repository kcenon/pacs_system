# SDS - 시퀀스 다이어그램

> **버전:** 1.1.0
> **상위 문서:** [SDS_KO.md](SDS_KO.md)
> **최종 수정일:** 2025-12-04

---

## 목차

- [1. Association 수립](#1-association-수립)
- [2. C-STORE 연산](#2-c-store-연산)
- [3. C-FIND 연산](#3-c-find-연산)
- [4. C-MOVE 연산](#4-c-move-연산)
- [5. 워크리스트 조회](#5-워크리스트-조회)
- [6. MPPS N-CREATE/N-SET](#6-mpps-n-createn-set)
- [7. 오류 처리 시나리오](#7-오류-처리-시나리오)

---

## 1. Association 수립

### SEQ-001: SCU 시작 Association

**추적성:** SRS-NET-003, FR-2.2

```
┌─────────┐                                    ┌─────────┐
│   SCU   │                                    │   SCP   │
│(클라이언트)│                                 │(서버)   │
└────┬────┘                                    └────┬────┘
     │                                              │
     │  1. TCP 연결                                 │
     │─────────────────────────────────────────────►│
     │                                              │
     │  2. A-ASSOCIATE-RQ                           │
     │  ┌────────────────────────────────────┐      │
     │  │ Calling AE: MY_SCU                 │      │
     │  │ Called AE: PACS_SCP                │      │
     │  │ Application Context: 1.2.840...    │      │
     │  │ Presentation Contexts:             │      │
     │  │   PC1: CT Image Storage            │      │
     │  │        - Implicit VR LE            │      │
     │  │        - Explicit VR LE            │      │
     │  │   PC2: Verification                │      │
     │  │        - Implicit VR LE            │      │
     │  │ Max PDU Size: 16384                │      │
     │  └────────────────────────────────────┘      │
     │─────────────────────────────────────────────►│
     │                                              │
     │                                    ┌─────────┴─────────┐
     │                                    │ 검증:             │
     │                                    │ - Called AE Title │
     │                                    │ - SOP Classes     │
     │                                    │ - Transfer Syntax │
     │                                    └─────────┬─────────┘
     │                                              │
     │  3. A-ASSOCIATE-AC                           │
     │  ┌────────────────────────────────────┐      │
     │  │ Accepted Contexts:                 │      │
     │  │   PC1: Accepted (Explicit VR LE)   │      │
     │  │   PC2: Accepted (Implicit VR LE)   │      │
     │  │ Max PDU Size: 16384                │      │
     │  └────────────────────────────────────┘      │
     │◄─────────────────────────────────────────────│
     │                                              │
     │            [Association 수립됨]              │
     │                                              │
```

### SEQ-002: Association 거부

**추적성:** SRS-NET-003

```
┌─────────┐                                    ┌─────────┐
│   SCU   │                                    │   SCP   │
└────┬────┘                                    └────┬────┘
     │                                              │
     │  1. TCP 연결                                 │
     │─────────────────────────────────────────────►│
     │                                              │
     │  2. A-ASSOCIATE-RQ                           │
     │  ┌────────────────────────────────────┐      │
     │  │ Called AE: UNKNOWN_AE              │      │
     │  └────────────────────────────────────┘      │
     │─────────────────────────────────────────────►│
     │                                              │
     │                                    ┌─────────┴─────────┐
     │                                    │ AE Title이        │
     │                                    │ 화이트리스트에 없음│
     │                                    └─────────┬─────────┘
     │                                              │
     │  3. A-ASSOCIATE-RJ                           │
     │  ┌────────────────────────────────────┐      │
     │  │ Result: Rejected (영구)            │      │
     │  │ Source: Service Provider (ACSE)    │      │
     │  │ Reason: Called AE Title 인식 불가  │      │
     │  └────────────────────────────────────┘      │
     │◄─────────────────────────────────────────────│
     │                                              │
     │  4. TCP 종료                                 │
     │◄─────────────────────────────────────────────│
     │                                              │
```

### SEQ-003: Association 해제

**추적성:** SRS-NET-003

```
┌─────────┐                                    ┌─────────┐
│   SCU   │                                    │   SCP   │
└────┬────┘                                    └────┬────┘
     │                                              │
     │         [Association 수립됨]                 │
     │                                              │
     │  1. A-RELEASE-RQ                             │
     │─────────────────────────────────────────────►│
     │                                              │
     │                                    ┌─────────┴─────────┐
     │                                    │ 세션 자원 정리    │
     │                                    └─────────┬─────────┘
     │                                              │
     │  2. A-RELEASE-RP                             │
     │◄─────────────────────────────────────────────│
     │                                              │
     │  3. TCP 종료                                 │
     │─────────────────────────────────────────────►│
     │                                              │
```

---

## 2. C-STORE 연산

### SEQ-004: 성공적인 C-STORE

**추적성:** SRS-SVC-002, FR-3.1

```
┌──────────┐          ┌──────────┐          ┌──────────┐          ┌──────────┐
│ 모달리티 │          │StorageSCP│          │FileStorage│         │IndexDB   │
│  (SCU)   │          │          │          │          │          │          │
└────┬─────┘          └────┬─────┘          └────┬─────┘          └────┬─────┘
     │                     │                     │                     │
     │  1. C-STORE-RQ      │                     │                     │
     │  (P-DATA-TF)        │                     │                     │
     │  ┌─────────────────────────────────┐      │                     │
     │  │ Command Set:                     │     │                     │
     │  │   CommandField: C-STORE-RQ       │     │                     │
     │  │   MessageID: 1                   │     │                     │
     │  │   AffectedSOPClass: CT Image     │     │                     │
     │  │   AffectedSOPInstance: 1.2.3...  │     │                     │
     │  │   Priority: MEDIUM               │     │                     │
     │  └─────────────────────────────────┘      │                     │
     │────────────────────►│                     │                     │
     │                     │                     │                     │
     │  2. Data Set        │                     │                     │
     │  (P-DATA-TF)        │                     │                     │
     │  ┌─────────────────────────────────┐      │                     │
     │  │ 환자/검사/시리즈 정보           │      │                     │
     │  │ 영상 속성                       │      │                     │
     │  │ 픽셀 데이터                     │      │                     │
     │  └─────────────────────────────────┘      │                     │
     │────────────────────►│                     │                     │
     │                     │                     │                     │
     │                     │ 3. 데이터셋 검증    │                     │
     │                     │    - SOP Class 확인 │                     │
     │                     │    - 속성 검증      │                     │
     │                     │                     │                     │
     │                     │ 4. 중복 확인        │                     │
     │                     │─────────────────────────────────────────►│
     │                     │                     │                     │
     │                     │◄─────────────────────────────────────────│
     │                     │    (존재하지 않음)  │                     │
     │                     │                     │                     │
     │                     │ 5. 파일 저장        │                     │
     │                     │────────────────────►│                     │
     │                     │                     │                     │
     │                     │                     │ 6. DICOM 파일       │
     │                     │                     │    파일시스템 기록  │
     │                     │                     │                     │
     │                     │◄────────────────────│                     │
     │                     │    (성공)           │                     │
     │                     │                     │                     │
     │                     │ 7. 인덱스 업데이트  │                     │
     │                     │─────────────────────────────────────────►│
     │                     │                     │                     │
     │                     │                     │    8. patient/study/│
     │                     │                     │    series/instance  │
     │                     │                     │    테이블 INSERT    │
     │                     │                     │                     │
     │                     │◄─────────────────────────────────────────│
     │                     │    (성공)           │                     │
     │                     │                     │                     │
     │  9. C-STORE-RSP     │                     │                     │
     │  ┌─────────────────────────────────┐      │                     │
     │  │ CommandField: C-STORE-RSP        │     │                     │
     │  │ MessageIDRespondedTo: 1          │     │                     │
     │  │ Status: 0x0000 (Success)         │     │                     │
     │  └─────────────────────────────────┘      │                     │
     │◄────────────────────│                     │                     │
     │                     │                     │                     │
```

### SEQ-005: 중복 처리를 포함한 C-STORE

**추적성:** SRS-STOR-002

```
┌──────────┐          ┌──────────┐          ┌──────────┐
│ 모달리티 │          │StorageSCP│          │IndexDB   │
└────┬─────┘          └────┬─────┘          └────┬─────┘
     │                     │                     │
     │  C-STORE-RQ         │                     │
     │────────────────────►│                     │
     │                     │                     │
     │                     │ 중복 확인           │
     │                     │────────────────────►│
     │                     │                     │
     │                     │◄────────────────────│
     │                     │ (EXISTS: 중복 발견) │
     │                     │                     │
     │                     │                     │
     │           ┌─────────┴─────────┐           │
     │           │ 중복 정책:       │           │
     │           │ ┌───────────────┐ │           │
     │           │ │ REJECT        │ │           │
     │           │ │ → 오류 반환   │ │           │
     │           │ └───────────────┘ │           │
     │           │ ┌───────────────┐ │           │
     │           │ │ REPLACE       │ │           │
     │           │ │ → 덮어쓰기    │ │           │
     │           │ └───────────────┘ │           │
     │           │ ┌───────────────┐ │           │
     │           │ │ IGNORE        │ │           │
     │           │ │ → 무시, OK    │ │           │
     │           │ └───────────────┘ │           │
     │           └─────────┬─────────┘           │
     │                     │                     │
     │  C-STORE-RSP        │                     │
     │  (정책에 따라 결정) │                     │
     │◄────────────────────│                     │
     │                     │                     │
```

---

## 3. C-FIND 연산

### SEQ-006: Patient Root 조회

**추적성:** SRS-SVC-004, FR-3.2

```
┌──────────┐          ┌──────────┐          ┌──────────┐
│  뷰어    │          │ QuerySCP │          │IndexDB   │
│  (SCU)   │          │          │          │          │
└────┬─────┘          └────┬─────┘          └────┬─────┘
     │                     │                     │
     │  1. C-FIND-RQ       │                     │
     │  ┌─────────────────────────────────┐      │
     │  │ AffectedSOPClass: PatientRoot   │      │
     │  │ Query Level: STUDY              │      │
     │  │ Matching Keys:                  │      │
     │  │   PatientName: "DOE^J*"         │      │
     │  │   StudyDate: "20250101-"        │      │
     │  │ Return Keys:                    │      │
     │  │   StudyInstanceUID              │      │
     │  │   StudyDescription              │      │
     │  │   Modality                      │      │
     │  └─────────────────────────────────┘      │
     │────────────────────►│                     │
     │                     │                     │
     │                     │ 2. SQL 쿼리 생성    │
     │                     │────────────────────►│
     │                     │                     │
     │                     │   SELECT * FROM studies s │
     │                     │   JOIN patients p ON ...  │
     │                     │   WHERE p.name LIKE 'DOE^J%' │
     │                     │   AND s.study_date >= '20250101' │
     │                     │                     │
     │                     │◄────────────────────│
     │                     │   (결과: 3개 행)    │
     │                     │                     │
     │  3. C-FIND-RSP #1   │                     │
     │  (Status: Pending)  │                     │
     │  ┌─────────────────────────────────┐      │
     │  │ PatientName: "DOE^JOHN"         │      │
     │  │ StudyInstanceUID: 1.2.3...      │      │
     │  │ StudyDescription: "CT CHEST"    │      │
     │  │ Modality: "CT"                  │      │
     │  └─────────────────────────────────┘      │
     │◄────────────────────│                     │
     │                     │                     │
     │  4. C-FIND-RSP #2   │                     │
     │  (Status: Pending)  │                     │
     │  ┌─────────────────────────────────┐      │
     │  │ PatientName: "DOE^JANE"         │      │
     │  │ StudyInstanceUID: 1.2.4...      │      │
     │  │ StudyDescription: "MR BRAIN"    │      │
     │  │ Modality: "MR"                  │      │
     │  └─────────────────────────────────┘      │
     │◄────────────────────│                     │
     │                     │                     │
     │  5. C-FIND-RSP #3   │                     │
     │  (Status: Pending)  │                     │
     │  ┌─────────────────────────────────┐      │
     │  │ PatientName: "DOE^JOHN"         │      │
     │  │ StudyInstanceUID: 1.2.5...      │      │
     │  │ StudyDescription: "XR CHEST"    │      │
     │  │ Modality: "CR"                  │      │
     │  └─────────────────────────────────┘      │
     │◄────────────────────│                     │
     │                     │                     │
     │  6. C-FIND-RSP      │                     │
     │  (Status: Success)  │                     │
     │  ┌─────────────────────────────────┐      │
     │  │ No Dataset                      │      │
     │  │ Status: 0x0000 (Success)        │      │
     │  └─────────────────────────────────┘      │
     │◄────────────────────│                     │
     │                     │                     │
```

### SEQ-007: C-FIND 취소

**추적성:** SRS-SVC-004

```
┌──────────┐          ┌──────────┐          ┌──────────┐
│  뷰어    │          │ QuerySCP │          │IndexDB   │
└────┬─────┘          └────┬─────┘          └────┬─────┘
     │                     │                     │
     │  C-FIND-RQ          │                     │
     │────────────────────►│                     │
     │                     │                     │
     │                     │ 조회 (많은 결과)    │
     │                     │────────────────────►│
     │                     │                     │
     │  C-FIND-RSP (Pending) │◄──────────────────│
     │◄────────────────────│   (1000+ 건 일치)  │
     │                     │                     │
     │  C-FIND-RSP (Pending) │                   │
     │◄────────────────────│                     │
     │                     │                     │
     │  C-CANCEL-RQ        │                     │
     │  ┌─────────────────────────────────┐      │
     │  │ MessageIDToCancel: 1            │      │
     │  └─────────────────────────────────┘      │
     │────────────────────►│                     │
     │                     │                     │
     │                     │ 조회 취소          │
     │                     │────────────────────►│
     │                     │                     │
     │  C-FIND-RSP         │                     │
     │  (Status: Canceled) │                     │
     │  ┌─────────────────────────────────┐      │
     │  │ Status: 0xFE00 (Cancel)         │      │
     │  └─────────────────────────────────┘      │
     │◄────────────────────│                     │
     │                     │                     │
```

---

## 4. C-MOVE 연산

### SEQ-008: C-MOVE 검색

**추적성:** SRS-SVC-005, FR-3.2

```
┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│  뷰어    │     │RetrieveSCP│    │FileStorage│    │DestSCP  │
│  (SCU)   │     │          │     │          │     │(뷰어)   │
└────┬─────┘     └────┬─────┘     └────┬─────┘     └────┬─────┘
     │                │                │                │
     │  1. C-MOVE-RQ  │                │                │
     │  ┌───────────────────────────────────────┐      │
     │  │ MoveDestination: VIEWER_SCP           │      │
     │  │ QueryLevel: STUDY                     │      │
     │  │ StudyInstanceUID: 1.2.3...            │      │
     │  └───────────────────────────────────────┘      │
     │───────────────►│                │                │
     │                │                │                │
     │                │ 2. 영상 조회   │                │
     │                │───────────────►│                │
     │                │                │                │
     │                │◄───────────────│                │
     │                │ (50개 인스턴스)│                │
     │                │                │                │
     │                │ 3. 대상에 연결                  │
     │                │────────────────────────────────►│
     │                │                │                │
     │                │◄────────────────────────────────│
     │                │ (Association 수립)              │
     │                │                │                │
     │  4. C-MOVE-RSP │                │                │
     │  (Pending: 50) │                │                │
     │◄───────────────│                │                │
     │                │                │                │
     │                │ 5. C-STORE-RQ (영상 1)         │
     │                │────────────────────────────────►│
     │                │                │                │
     │                │◄────────────────────────────────│
     │                │ C-STORE-RSP (Success)           │
     │                │                │                │
     │  6. C-MOVE-RSP │                │                │
     │  (Pending: 49) │                │                │
     │◄───────────────│                │                │
     │                │                │                │
     │                │     ... (48개 추가 영상 반복) ...
     │                │                │                │
     │                │ C-STORE-RQ (영상 50)           │
     │                │────────────────────────────────►│
     │                │                │                │
     │                │◄────────────────────────────────│
     │                │ C-STORE-RSP (Success)           │
     │                │                │                │
     │  7. C-MOVE-RSP │                │                │
     │  (Success)     │                │                │
     │  ┌───────────────────────────────────────┐      │
     │  │ Status: 0x0000 (Success)              │      │
     │  │ NumberOfCompletedSuboperations: 50    │      │
     │  │ NumberOfFailedSuboperations: 0        │      │
     │  │ NumberOfWarningSuboperations: 0       │      │
     │  └───────────────────────────────────────┘      │
     │◄───────────────│                │                │
     │                │                │                │
     │                │ 8. 대상에 해제                  │
     │                │────────────────────────────────►│
     │                │                │                │
```

---

## 5. 워크리스트 조회

### SEQ-009: Modality Worklist 조회

**추적성:** SRS-SVC-006, FR-3.3

```
┌──────────┐          ┌──────────┐          ┌──────────┐
│ 모달리티 │          │WorklistSCP│         │ RIS/HIS  │
│  (SCU)   │          │          │          │ 인터페이스│
└────┬─────┘          └────┬─────┘          └────┬─────┘
     │                     │                     │
     │  1. C-FIND-RQ       │                     │
     │  ┌─────────────────────────────────┐      │
     │  │ AffectedSOPClass: MWL           │      │
     │  │ Matching Keys:                  │      │
     │  │   ScheduledStationAETitle: CT01 │      │
     │  │   ScheduledProcedureDate: TODAY │      │
     │  │ Return Keys:                    │      │
     │  │   PatientName                   │      │
     │  │   PatientID                     │      │
     │  │   AccessionNumber               │      │
     │  │   ScheduledProcedureStepSeq     │      │
     │  │     - ScheduledProcedureStepID  │      │
     │  │     - Modality                  │      │
     │  │     - ScheduledProcedureDesc    │      │
     │  └─────────────────────────────────┘      │
     │────────────────────►│                     │
     │                     │                     │
     │                     │ 2. RIS 조회        │
     │                     │────────────────────►│
     │                     │                     │
     │                     │◄────────────────────│
     │                     │ (예약된 검사)       │
     │                     │                     │
     │  3. C-FIND-RSP      │                     │
     │  ┌─────────────────────────────────┐      │
     │  │ PatientName: "DOE^JOHN"         │      │
     │  │ PatientID: "12345"              │      │
     │  │ AccessionNumber: "ACC001"       │      │
     │  │ ScheduledProcedureStepSequence: │      │
     │  │   Item:                         │      │
     │  │     StepID: "STEP001"           │      │
     │  │     Modality: "CT"              │      │
     │  │     Description: "CT Chest"     │      │
     │  └─────────────────────────────────┘      │
     │◄────────────────────│                     │
     │                     │                     │
     │  ... (추가 결과) │                        │
     │                     │                     │
     │  4. C-FIND-RSP (Success - 데이터 없음)    │
     │◄────────────────────│                     │
     │                     │                     │
```

---

## 6. MPPS N-CREATE/N-SET

### SEQ-010: MPPS 진행 중

**추적성:** SRS-SVC-007, FR-3.4

```
┌──────────┐          ┌──────────┐          ┌──────────┐
│ 모달리티 │          │ MPPS_SCP │          │ RIS/HIS  │
│  (SCU)   │          │          │          │ 인터페이스│
└────┬─────┘          └────┬─────┘          └────┬─────┘
     │                     │                     │
     │  [검사 시작됨]      │                     │
     │                     │                     │
     │  1. N-CREATE-RQ     │                     │
     │  ┌─────────────────────────────────┐      │
     │  │ AffectedSOPClass: MPPS          │      │
     │  │ AffectedSOPInstance: 1.2.3...   │      │
     │  │ Dataset:                        │      │
     │  │   PerformedStationAETitle: CT01 │      │
     │  │   PerformedProcedureStepStatus: │      │
     │  │       "IN PROGRESS"             │      │
     │  │   PerformedProcedureStepStartDT:│      │
     │  │       "20250601120000"          │      │
     │  │   ScheduledStepAttributesSeq:   │      │
     │  │     - StudyInstanceUID          │      │
     │  │     - AccessionNumber           │      │
     │  │     - RequestedProcedureID      │      │
     │  └─────────────────────────────────┘      │
     │────────────────────►│                     │
     │                     │                     │
     │                     │ 2. MPPS 저장        │
     │                     │ 3. RIS 알림         │
     │                     │────────────────────►│
     │                     │                     │
     │                     │◄────────────────────│
     │                     │                     │
     │  4. N-CREATE-RSP    │                     │
     │  ┌─────────────────────────────────┐      │
     │  │ Status: 0x0000 (Success)        │      │
     │  │ AffectedSOPInstance: 1.2.3...   │      │
     │  └─────────────────────────────────┘      │
     │◄────────────────────│                     │
     │                     │                     │
```

### SEQ-011: MPPS 완료

**추적성:** SRS-SVC-007

```
┌──────────┐          ┌──────────┐          ┌──────────┐
│ 모달리티 │          │ MPPS_SCP │          │ RIS/HIS  │
└────┬─────┘          └────┬─────┘          └────┬─────┘
     │                     │                     │
     │  [검사 완료됨]      │                     │
     │                     │                     │
     │  1. N-SET-RQ        │                     │
     │  ┌─────────────────────────────────┐      │
     │  │ RequestedSOPClass: MPPS         │      │
     │  │ RequestedSOPInstance: 1.2.3...  │      │
     │  │ ModificationList:               │      │
     │  │   PerformedProcedureStepStatus: │      │
     │  │       "COMPLETED"               │      │
     │  │   PerformedProcedureStepEndDT:  │      │
     │  │       "20250601123000"          │      │
     │  │   PerformedSeriesSequence:      │      │
     │  │     - SeriesInstanceUID         │      │
     │  │     - PerformedProtocolName     │      │
     │  │     - ReferencedImageSequence:  │      │
     │  │         (SOP 인스턴스 목록)     │      │
     │  └─────────────────────────────────┘      │
     │────────────────────►│                     │
     │                     │                     │
     │                     │ 2. MPPS 업데이트   │
     │                     │ 3. RIS 알림        │
     │                     │────────────────────►│
     │                     │                     │
     │                     │   [절차 완료]       │
     │                     │                     │
     │                     │◄────────────────────│
     │                     │                     │
     │  4. N-SET-RSP       │                     │
     │  ┌─────────────────────────────────┐      │
     │  │ Status: 0x0000 (Success)        │      │
     │  └─────────────────────────────────┘      │
     │◄────────────────────│                     │
     │                     │                     │
```

---

## 7. 오류 처리 시나리오

### SEQ-012: 네트워크 타임아웃

**추적성:** SRS-NET-004, NFR-2

```
┌──────────┐          ┌──────────┐
│   SCU    │          │   SCP    │
└────┬─────┘          └────┬─────┘
     │                     │
     │  C-STORE-RQ         │
     │────────────────────►│
     │                     │
     │                     │ [처리 중...]
     │                     │
     │  [타임아웃: 30초]   │
     │                     │
     │  A-ABORT            │
     │  ┌─────────────────────────────────┐
     │  │ Source: Service User           │
     │  │ Reason: 사유 지정되지 않음     │
     │  └─────────────────────────────────┘
     │────────────────────►│
     │                     │
     │                     │ [자원 정리]
     │                     │
     │  TCP 종료           │
     │────────────────────►│
     │                     │
     │  [지수 백오프로 재시도?] │
     │                     │
```

### SEQ-013: 저장 오류 복구

**추적성:** SRS-STOR-002, NFR-2

```
┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│ 모달리티 │     │StorageSCP│     │FileStorage│    │IndexDB   │
└────┬─────┘     └────┬─────┘     └────┬─────┘     └────┬─────┘
     │                │                │                │
     │  C-STORE-RQ    │                │                │
     │───────────────►│                │                │
     │                │                │                │
     │                │ 파일 저장      │                │
     │                │───────────────►│                │
     │                │                │                │
     │                │                │ [디스크 용량 부족 오류]
     │                │◄───────────────│                │
     │                │ (오류)         │                │
     │                │                │                │
     │                │ [트랜잭션 롤백 - 인덱스 업데이트 없음]
     │                │                │                │
     │  C-STORE-RSP   │                │                │
     │  (오류)        │                │                │
     │  ┌─────────────────────────────────┐             │
     │  │ Status: 0xA700 (자원 부족)      │             │
     │  │ ErrorComment: "저장 공간 부족"  │             │
     │  └─────────────────────────────────┘             │
     │◄───────────────│                │                │
     │                │                │                │
```

### SEQ-014: 연산 중 Association 중단

**추적성:** SRS-NET-003

```
┌──────────┐          ┌──────────┐          ┌──────────┐
│ 모달리티 │          │StorageSCP│          │FileStorage│
└────┬─────┘          └────┬─────┘          └────┬─────┘
     │                     │                     │
     │  C-STORE-RQ (대용량)│                     │
     │────────────────────►│                     │
     │                     │                     │
     │  [네트워크 중단]    │                     │
     │                     │                     │
     │  [TCP RST 수신]     │                     │
     │                     │                     │
     │                     │ [연결 끊김 감지]    │
     │                     │                     │
     │                     │ 부분 쓰기 롤백      │
     │                     │────────────────────►│
     │                     │                     │
     │                     │◄────────────────────│
     │                     │ (파일 삭제됨)       │
     │                     │                     │
     │                     │ 오류 로깅           │
     │                     │ Association 정리    │
     │                     │ 자원 해제           │
     │                     │                     │
```

---

*문서 버전: 1.0.0*
*작성일: 2025-11-30*
*작성자: kcenon@naver.com*
