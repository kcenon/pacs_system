# 제품 요구사항 정의서 - PACS 시스템

> **버전:** 0.2.0.0
> **최종 수정일:** 2026-02-08
> **언어:** [English](PRD.md) | **한국어**

---

## 목차

- [요약](#요약)
- [제품 비전](#제품-비전)
- [대상 사용자](#대상-사용자)
- [기능 요구사항](#기능-요구사항)
- [비기능 요구사항](#비기능-요구사항)
- [시스템 아키텍처 요구사항](#시스템-아키텍처-요구사항)
- [DICOM 적합성 요구사항](#dicom-적합성-요구사항)
- [통합 요구사항](#통합-요구사항)
- [보안 요구사항](#보안-요구사항)
- [성능 요구사항](#성능-요구사항)
- [개발 단계](#개발-단계)
- [성공 지표](#성공-지표)
- [위험 및 완화 방안](#위험-및-완화-방안)
- [부록](#부록)

---

## 요약

### 제품명
PACS 시스템 (Picture Archiving and Communication System)

### 제품 설명
외부 DICOM 라이브러리 없이 kcenon 에코시스템만을 활용하여 구축된 운영 환경 수준의 C++20 PACS 구현체입니다. 이 시스템은 DICOM 표준을 처음부터 구현하여 기존 에코시스템 컴포넌트의 고성능 인프라를 활용하면서 코드베이스에 대한 완전한 제어권을 제공합니다.

### 핵심 차별화 요소
- **외부 DICOM 의존성 제로**: kcenon 에코시스템만을 사용한 순수 구현
- **고성능**: SIMD 가속, 락프리 큐, 비동기 I/O, 오브젝트 풀 메모리 관리
- **완전한 에코시스템 통합**: 6개 기존 시스템과의 네이티브 통합
- **운영 환경 수준**: 포괄적인 CI/CD, 새니타이저, 품질 메트릭
- **완전한 DICOMweb 지원**: PS3.18 기반 WADO-RS, STOW-RS, QIDO-RS
- **19개 엔드포인트 REST API**: Crow 프레임워크를 활용한 완전한 웹 관리 및 모니터링
- **AI 통합**: 의료 영상 분석을 위한 외부 AI 서비스 연동
- **다중 노드 연합**: 라우팅, 동기화, 프리페치, 원격 노드 관리가 포함된 클라이언트 모듈

---

## 제품 비전

### 비전 선언문
의료 영상 워크플로우에 대한 완전한 투명성과 커스터마이즈 가능성을 제공하면서, kcenon 에코시스템의 역량을 입증하는 완전히 제어 가능한 고성능 PACS 솔루션을 만듭니다.

### 전략적 목표

| 목표 | 설명 | 성공 기준 |
|------|------|----------|
| **독립성** | 외부 DICOM 라이브러리 의존성 제거 | GPL/LGPL 의존성 제로 |
| **성능** | DCMTK 성능과 동등 또는 그 이상 | ≥100 MB/s 이미지 저장 |
| **에코시스템** | 기존 시스템 최대 재사용 | ≥80% 인프라 재사용 |
| **적합성** | DICOM 적합성 요구사항 충족 | 적합성 테스트 통과 |
| **품질** | 에코시스템 품질 표준 충족 | CI/CD 그린, 80%+ 커버리지 |

---

## 대상 사용자

### 주요 사용자

#### 1. 의료 IT 개발자
- **프로필**: 의료 영상 애플리케이션을 구축하는 소프트웨어 개발자
- **필요사항**:
  - 잘 문서화된 DICOM API
  - 기존 시스템과의 쉬운 통합
  - 커스터마이즈 가능한 DICOM 서비스
- **고충점**:
  - 복잡한 DCMTK 학습 곡선
  - GPL 라이브러리와의 라이선스 우려
  - 제한된 커스터마이즈 옵션

#### 2. 의료 장비 통합 엔지니어
- **프로필**: 영상 장비를 PACS에 연결하는 엔지니어
- **필요사항**:
  - 안정적인 Storage SCP
  - Modality Worklist 지원
  - MPPS 통합
- **고충점**:
  - 상호운용성 문제
  - 제한된 디버깅 도구
  - 복잡한 프로토콜 디버깅

#### 3. 연구 기관
- **프로필**: 의료 영상 분야의 학술 연구자
- **필요사항**:
  - 수정을 위한 소스 코드 접근
  - 사용자 정의 SOP 클래스 지원
  - 유연한 데이터 추출
- **고충점**:
  - 블랙박스 상용 솔루션
  - 연구용 라이선스 제한

### 보조 사용자

#### 시스템 관리자
- 시스템 상태 및 성능 모니터링
- DICOM 서비스 구성
- 저장소 및 보존 정책 관리

#### 영상의학과 의사 (간접)
- PACS 뷰어 애플리케이션의 최종 사용자
- 빠른 이미지 검색 필요
- 안정적인 워크리스트 통합 필요

---

## 기능 요구사항

### FR-1: DICOM 코어 데이터 처리

#### FR-1.1: 데이터 요소 처리
| ID | 요구사항 | 우선순위 | 단계 |
|----|----------|----------|------|
| FR-1.1.1 | DICOM 데이터 요소 파싱 (태그, VR, 길이, 값) | 필수 | 1 |
| FR-1.1.2 | PS3.5에 따른 모든 34개 VR 타입 지원 (DICOM 2019b 포함) | 필수 | 1 |
| FR-1.1.3 | 중첩된 시퀀스(SQ) 요소의 재귀적 처리 | 필수 | 1 |
| FR-1.1.4 | 프라이빗 태그 및 프라이빗 크리에이터 요소 지원 | 권장 | 2 |
| FR-1.1.5 | 데이터 요소 일관성 검증 | 권장 | 2 |

#### FR-1.2: 데이터 세트 연산
| ID | 요구사항 | 우선순위 | 단계 |
|----|----------|----------|------|
| FR-1.2.1 | 데이터 요소 생성, 수정, 삭제 | 필수 | 1 |
| FR-1.2.2 | 태그 순서로 데이터 요소 순회 | 필수 | 1 |
| FR-1.2.3 | 태그, 키워드 또는 경로로 요소 검색 | 필수 | 1 |
| FR-1.2.4 | 데이터 세트 깊은 복사 및 이동 | 필수 | 1 |
| FR-1.2.5 | 충돌 해결을 통한 데이터 세트 병합 | 권장 | 2 |

#### FR-1.3: DICOM 파일 처리 (Part 10)
| ID | 요구사항 | 우선순위 | 단계 |
|----|----------|----------|------|
| FR-1.3.1 | 파일 메타 정보가 포함된 DICOM 파일 읽기 | 필수 | 1 |
| FR-1.3.2 | 적절한 프리앰블 및 접두사를 포함한 DICOM 파일 쓰기 | 필수 | 1 |
| FR-1.3.3 | Implicit VR Little Endian 지원 | 필수 | 1 |
| FR-1.3.4 | Explicit VR Little Endian 지원 | 필수 | 1 |
| FR-1.3.5 | Explicit VR Big Endian 지원 | 권장 | 2 |
| FR-1.3.6 | 읽기 시 Transfer Syntax 검증 | 필수 | 1 |

---

### FR-2: 네트워크 프로토콜

#### FR-2.1: 상위 레이어 프로토콜 (PDU)
| ID | 요구사항 | 우선순위 | 단계 |
|----|----------|----------|------|
| FR-2.1.1 | A-ASSOCIATE-RQ PDU 인코딩/디코딩 구현 | 필수 | 2 |
| FR-2.1.2 | A-ASSOCIATE-AC PDU 인코딩/디코딩 구현 | 필수 | 2 |
| FR-2.1.3 | A-ASSOCIATE-RJ PDU 인코딩/디코딩 구현 | 필수 | 2 |
| FR-2.1.4 | P-DATA-TF PDU 인코딩/디코딩 구현 | 필수 | 2 |
| FR-2.1.5 | A-RELEASE-RQ/RP PDU 인코딩/디코딩 구현 | 필수 | 2 |
| FR-2.1.6 | A-ABORT PDU 인코딩/디코딩 구현 | 필수 | 2 |
| FR-2.1.7 | PDU 프래그먼트 재조립 처리 | 필수 | 2 |

#### FR-2.2: 연결 관리
| ID | 요구사항 | 우선순위 | 단계 |
|----|----------|----------|------|
| FR-2.2.1 | 연결 상태 머신 관리 (PS3.8 Sta1-Sta13 기준 13개 상태) | 필수 | 2 |
| FR-2.2.2 | 프레젠테이션 컨텍스트 협상 | 필수 | 2 |
| FR-2.2.3 | 다중 동시 연결 지원 | 필수 | 2 |
| FR-2.2.4 | 연결 타임아웃 처리 구현 | 필수 | 2 |
| FR-2.2.5 | 확장 협상 항목 지원 | 권장 | 3 |
| FR-2.2.6 | 사용자 인증 협상 구현 | 선택 | 4 |

#### FR-2.3: DIMSE 메시지 교환
| ID | 요구사항 | 우선순위 | 단계 |
|----|----------|----------|------|
| FR-2.3.1 | C-ECHO 요청/응답 구현 | 필수 | 2 |
| FR-2.3.2 | C-STORE 요청/응답 구현 | 필수 | 2 |
| FR-2.3.3 | C-FIND 요청/응답 구현 | 필수 | 3 |
| FR-2.3.4 | C-MOVE 요청/응답 구현 | 필수 | 3 |
| FR-2.3.5 | C-GET 요청/응답 구현 | 권장 | 3 |
| FR-2.3.6 | N-CREATE 요청/응답 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-2.3.7 | N-SET 요청/응답 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-2.3.8 | N-GET 요청/응답 구현 | 선택 | 4 | ✅ 구현됨 |
| FR-2.3.9 | N-EVENT-REPORT 요청/응답 구현 | 선택 | 4 | ✅ 구현됨 |
| FR-2.3.10 | N-ACTION 요청/응답 구현 | 선택 | 4 | ✅ 구현됨 |
| FR-2.3.11 | N-DELETE 요청/응답 구현 | 선택 | 4 | ✅ 구현됨 |

---

### FR-3: DICOM 서비스

#### FR-3.1: 검증 서비스
| ID | 요구사항 | 우선순위 | 단계 |
|----|----------|----------|------|
| FR-3.1.1 | Verification SCP 구현 (C-ECHO 응답자) | 필수 | 2 |
| FR-3.1.2 | Verification SCU 구현 (C-ECHO 개시자) | 필수 | 2 |
| FR-3.1.3 | 모든 연결 상태에서 검증 지원 | 필수 | 2 |

#### FR-3.2: 저장 서비스
| ID | 요구사항 | 우선순위 | 단계 |
|----|----------|----------|------|
| FR-3.2.1 | CT 이미지용 Storage SCP 구현 | 필수 | 3 |
| FR-3.2.2 | MR 이미지용 Storage SCP 구현 | 필수 | 3 |
| FR-3.2.3 | CR/DX 이미지용 Storage SCP 구현 | 필수 | 3 |
| FR-3.2.4 | 이차 캡처용 Storage SCP 구현 | 권장 | 3 |
| FR-3.2.5 | 이미지 전송용 Storage SCU 구현 | 필수 | 3 |
| FR-3.2.6 | 저장 커밋 처리 (선택 사항) | 선택 | 4 |
| FR-3.2.7 | 모든 표준 저장 SOP 클래스 지원 | 권장 | 4 |

#### FR-3.3: 조회/검색 서비스
| ID | 요구사항 | 우선순위 | 단계 |
|----|----------|----------|------|
| FR-3.3.1 | Patient Root Q/R 정보 모델 구현 | 필수 | 3 |
| FR-3.3.2 | Study Root Q/R 정보 모델 구현 | 필수 | 3 |
| FR-3.3.3 | 환자 레벨 조회 지원 (C-FIND) | 필수 | 3 |
| FR-3.3.4 | 스터디 레벨 조회 지원 (C-FIND) | 필수 | 3 |
| FR-3.3.5 | 시리즈 레벨 조회 지원 (C-FIND) | 필수 | 3 |
| FR-3.3.6 | 이미지 레벨 조회 지원 (C-FIND) | 필수 | 3 |
| FR-3.3.7 | 이미지 검색용 C-MOVE 구현 | 필수 | 3 |
| FR-3.3.8 | 이미지 검색용 C-GET 구현 | 권장 | 3 |

#### FR-3.4: Modality Worklist 서비스
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-3.4.1 | 예약된 절차용 MWL SCP 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-3.4.2 | 예약된 절차 단계 매칭 지원 | 권장 | 4 | ✅ 구현됨 |
| FR-3.4.3 | 환자 인구통계 조회 지원 | 권장 | 4 | ✅ 구현됨 |
| FR-3.4.4 | 워크리스트 조회 시작용 MWL SCU 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-3.4.5 | 워크리스트 관리를 위한 REST API 제공 (CRUD) | 권장 | 4 | ✅ 구현됨 |
| FR-3.4.6 | HIS/RIS 시스템과의 통합 (인터페이스) | 선택 | 5 | |

#### FR-3.5: MPPS 서비스
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-3.5.1 | 절차 추적용 MPPS SCP 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-3.5.2 | MPPS 생성용 N-CREATE 지원 | 권장 | 4 | ✅ 구현됨 |
| FR-3.5.3 | MPPS 수정용 N-SET 지원 | 권장 | 4 | ✅ 구현됨 |
| FR-3.5.4 | 절차 상태 추적 (진행 중, 완료, 중단) | 권장 | 4 | ✅ 구현됨 |
| FR-3.5.5 | 절차 상태 보고용 MPPS SCU 구현 | 권장 | 4 | ✅ 구현됨 |

---

### FR-4: 저장 백엔드

#### FR-4.1: 파일 시스템 저장소
| ID | 요구사항 | 우선순위 | 단계 |
|----|----------|----------|------|
| FR-4.1.1 | 계층적 디렉토리 구조로 DICOM 파일 저장 | 필수 | 3 |
| FR-4.1.2 | 설정 가능한 파일 명명 규칙 지원 | 필수 | 3 |
| FR-4.1.3 | 원자적 파일 연산 구현 | 필수 | 3 |
| FR-4.1.4 | 중복 SOP 인스턴스 감지 처리 | 필수 | 3 |
| FR-4.1.5 | 파일 압축 지원 (선택 사항) | 선택 | 4 |

#### FR-4.2: 인덱스 데이터베이스
| ID | 요구사항 | 우선순위 | 단계 |
|----|----------|----------|------|
| FR-4.2.1 | 환자/스터디/시리즈/인스턴스 계층 인덱싱 | 필수 | 3 |
| FR-4.2.2 | 일반 속성에 의한 빠른 조회 지원 | 필수 | 3 |
| FR-4.2.3 | 참조 무결성 유지 | 필수 | 3 |
| FR-4.2.4 | 동시 읽기 작업 지원 | 필수 | 3 |
| FR-4.2.5 | 데이터베이스 복구 메커니즘 구현 | 권장 | 4 |

---

### FR-5: 보안 서비스

| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-5.1 | PS3.15 Annex E 기반 DICOM 데이터셋 익명화 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-5.2 | PS3.15 기반 DICOM 데이터셋 전자 서명 지원 | 선택 | 4 | ✅ 구현됨 |
| FR-5.3 | DICOM 연산용 역할 기반 접근 제어(RBAC) 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-5.4 | TLS 및 서명용 X.509 인증서 관리 지원 | 선택 | 4 | ✅ 구현됨 |
| FR-5.5 | 선택적 익명화를 위한 태그 수준 보안 액션 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-5.6 | 개인정보 보호 재식별을 위한 UID 매핑 제공 | 권장 | 4 | ✅ 구현됨 |
| FR-5.7 | SQLite 기반 영구 보안 저장소 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-5.8 | 보안 설정용 REST API 엔드포인트 제공 | 권장 | 4 | ✅ 구현됨 |

---

### FR-6: 웹/REST API 서비스

#### FR-6.1: REST API 서버
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-6.1.1 | Crow 웹 프레임워크 기반 REST API 서버 제공 | 권장 | 4 | ✅ 구현됨 |
| FR-6.1.2 | 웹 브라우저 접근을 위한 CORS 지원 | 권장 | 4 | ✅ 구현됨 |
| FR-6.1.3 | 비동기/동기 서버 모드 구현 | 권장 | 4 | ✅ 구현됨 |

#### FR-6.2: DICOMweb 서비스
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-6.2.1 | PS3.18 기반 DICOMweb WADO-RS 웹 이미지 검색 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-6.2.2 | PS3.18 기반 DICOMweb STOW-RS 웹 이미지 저장 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-6.2.3 | PS3.18 기반 DICOMweb QIDO-RS 웹 이미지 조회 구현 | 권장 | 4 | ✅ 구현됨 |

#### FR-6.3: REST API 엔드포인트 (19개 모듈)
| ID | 엔드포인트 모듈 | 설명 | 상태 |
|----|----------------|------|------|
| FR-6.3.1 | 시스템 엔드포인트 | 시스템 설정, 상태, 버전 | ✅ 구현됨 |
| FR-6.3.2 | 메트릭 엔드포인트 | 성능 메트릭 및 모니터링 | ✅ 구현됨 |
| FR-6.3.3 | 스터디 엔드포인트 | 스터디 수준 CRUD 연산 | ✅ 구현됨 |
| FR-6.3.4 | 시리즈 엔드포인트 | 시리즈 수준 연산 | ✅ 구현됨 |
| FR-6.3.5 | 환자 엔드포인트 | 환자 정보 관리 | ✅ 구현됨 |
| FR-6.3.6 | 메타데이터 엔드포인트 | DICOM 메타데이터 조회 | ✅ 구현됨 |
| FR-6.3.7 | DICOMweb 엔드포인트 | WADO-RS, STOW-RS, QIDO-RS | ✅ 구현됨 |
| FR-6.3.8 | 작업 엔드포인트 | 비동기 작업 관리 및 추적 | ✅ 구현됨 |
| FR-6.3.9 | 라우팅 엔드포인트 | 메시지 라우팅 설정 | ✅ 구현됨 |
| FR-6.3.10 | 원격 노드 엔드포인트 | 원격 PACS 노드 관리 | ✅ 구현됨 |
| FR-6.3.11 | 워크리스트 엔드포인트 | 워크리스트 관리 | ✅ 구현됨 |
| FR-6.3.12 | 주석 엔드포인트 | 주석 CRUD 연산 | ✅ 구현됨 |
| FR-6.3.13 | 뷰어 상태 엔드포인트 | 뷰어 상태 영속성 | ✅ 구현됨 |
| FR-6.3.14 | 측정 엔드포인트 | 측정 데이터 관리 | ✅ 구현됨 |
| FR-6.3.15 | 키 이미지 엔드포인트 | 키 이미지 선택 관리 | ✅ 구현됨 |
| FR-6.3.16 | 썸네일 엔드포인트 | 이미지 썸네일 생성 | ✅ 구현됨 |
| FR-6.3.17 | 감사 엔드포인트 | 감사 로그 접근 | ✅ 구현됨 |
| FR-6.3.18 | 보안 엔드포인트 | 보안 설정 | ✅ 구현됨 |
| FR-6.3.19 | 연결 엔드포인트 | DICOM 연결 관리 | ✅ 구현됨 |

---

### FR-7: 워크플로우 서비스

#### FR-7.1: 자동 프리페치 서비스
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-7.1.1 | 원격 PACS에서 워크리스트 기반 이전 스터디 프리페치 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-7.1.2 | 설정 가능한 프리페치 기준 지원 (모달리티, 신체 부위, 조회 기간) | 권장 | 4 | ✅ 구현됨 |
| FR-7.1.3 | 다수의 원격 PACS 서버에서 다중 소스 프리페치 지원 | 권장 | 4 | ✅ 구현됨 |
| FR-7.1.4 | 프리페치 요청의 속도 제한 및 중복 제거 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-7.1.5 | 실패한 프리페치 연산에 대한 재시도 로직 제공 | 권장 | 4 | ✅ 구현됨 |

#### FR-7.2: 태스크 스케줄러 서비스
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-7.2.1 | 인터벌 기반, cron 유사, 일회성 태스크 스케줄링 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-7.2.2 | 내장 태스크 유형 제공: 정리, 아카이브, 검증 | 권장 | 4 | ✅ 구현됨 |
| FR-7.2.3 | 태스크 라이프사이클 관리 지원 (일시정지, 재개, 취소, 트리거) | 권장 | 4 | ✅ 구현됨 |
| FR-7.2.4 | 설정 가능한 보존 기간의 실행 이력 추적 | 권장 | 4 | ✅ 구현됨 |
| FR-7.2.5 | 설정 가능한 시도 횟수 및 지연의 재시도 메커니즘 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-7.2.6 | 비동기 실행 지원의 태스크별 실행 타임아웃 | 권장 | 4 | ✅ 구현됨 |

#### FR-7.3: 스터디 잠금 관리자
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-7.3.1 | 스터디 접근 제어를 위한 스레드 안전 배타적/공유 잠금 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-7.3.2 | HSM 연산을 위한 최우선 순위 마이그레이션 잠금 지원 | 권장 | 4 | ✅ 구현됨 |
| FR-7.3.3 | 자동 잠금 만료 및 토큰 기반 해제 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-7.3.4 | 관리자 연산을 위한 강제 잠금 해제 기능 제공 | 권장 | 4 | ✅ 구현됨 |

---

### FR-8: 클라우드 스토리지

| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-8.1 | DICOM 파일용 AWS S3 저장 백엔드 지원 | 권장 | 4 | ✅ 구현됨 (Mock) |
| FR-8.2 | Azure Blob Storage 저장 백엔드 지원 | 권장 | 4 | ✅ 구현됨 (Mock) |
| FR-8.3 | 3단계 계층적 저장 관리(HSM) 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-8.4 | 저장 계층 간 자동 연령 기반 마이그레이션 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-8.5 | 모든 저장 계층에서 투명한 데이터 검색 제공 | 권장 | 4 | ✅ 구현됨 |
| FR-8.6 | 업로드/다운로드 모니터링을 위한 진행 콜백 지원 | 권장 | 4 | ✅ 구현됨 |
| FR-8.7 | 운영 S3 연산을 위한 전체 AWS SDK 통합 | 선택 | 5 | |
| FR-8.8 | 운영 Blob Storage 연산을 위한 전체 Azure SDK 통합 | 선택 | 5 | |

*참고: FR-8.1과 FR-8.2는 현재 API 검증 및 테스트를 위한 Mock 구현입니다. 전체 SDK 통합(FR-8.7, FR-8.8)은 5단계에서 계획되어 있습니다.*

---

### FR-9: AI 통합

| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-9.1 | 외부 추론 엔드포인트용 AI 서비스 커넥터 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-9.2 | 추론 출력 처리를 위한 AI 결과 핸들러 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-9.3 | AI/CAD 출력을 위한 Segmentation(SEG) SOP 클래스 지원 | 권장 | 4 | ✅ 구현됨 |
| FR-9.4 | AI/CAD 결과를 위한 Structured Report(SR) SOP 클래스 지원 | 권장 | 4 | ✅ 구현됨 |
| FR-9.5 | AI 생성 DICOM 객체에 대한 IOD 검증 제공 | 권장 | 4 | ✅ 구현됨 |

---

### FR-10: 클라이언트 모듈

#### FR-10.1: 작업 관리자
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-10.1.1 | 비동기 DICOM 연산을 위한 클라이언트측 작업 관리 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-10.1.2 | 작업 상태, 진행률 및 완료 추적 | 권장 | 4 | ✅ 구현됨 |
| FR-10.1.3 | 작업 조회 및 관리를 위한 REST API 제공 | 권장 | 4 | ✅ 구현됨 |

#### FR-10.2: 라우팅 관리자
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-10.2.1 | DICOM 데이터 배포를 위한 설정 가능한 라우팅 규칙 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-10.2.2 | 모달리티, 신체 부위, AE Title 기반 규칙 라우팅 지원 | 권장 | 4 | ✅ 구현됨 |
| FR-10.2.3 | 라우팅 규칙 관리를 위한 REST API 제공 | 권장 | 4 | ✅ 구현됨 |

#### FR-10.3: 동기화 관리자
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-10.3.1 | PACS 노드 간 데이터 동기화 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-10.3.2 | 동기화 설정, 이력 추적 및 충돌 해결 지원 | 권장 | 4 | ✅ 구현됨 |

#### FR-10.4: 원격 노드 관리자
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-10.4.1 | 원격 PACS 노드 탐색 및 관리 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-10.4.2 | 원격 노드 등록 및 상태 모니터링을 위한 REST API 제공 | 권장 | 4 | ✅ 구현됨 |

#### FR-10.5: 프리페치 관리자
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-10.5.1 | 지능형 이전 스터디 프리페치 전략 관리 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-10.5.2 | 프리페치 규칙 설정 및 이력 추적 지원 | 권장 | 4 | ✅ 구현됨 |

---

### FR-11: 주석, 뷰어 상태 및 임상 데이터

#### FR-11.1: 주석 지원
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-11.1.1 | DICOM 이미지 주석을 위한 주석 리포지토리 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-11.1.2 | 주석 CRUD 연산을 위한 REST API 제공 | 권장 | 4 | ✅ 구현됨 |

#### FR-11.2: 뷰어 상태 관리
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-11.2.1 | 사용자 표시 설정을 위한 뷰어 상태 영속성 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-11.2.2 | 세션별 상태 추적을 위한 뷰어 상태 레코드 지원 | 권장 | 4 | ✅ 구현됨 |
| FR-11.2.3 | 뷰어 상태 관리를 위한 REST API 제공 | 권장 | 4 | ✅ 구현됨 |

#### FR-11.3: 키 이미지 관리
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-11.3.1 | 주요 소견을 위한 키 이미지 선택 리포지토리 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-11.3.2 | 키 이미지 선택 관리를 위한 REST API 제공 | 권장 | 4 | ✅ 구현됨 |

#### FR-11.4: 측정 데이터
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-11.4.1 | 임상 측정을 위한 측정 리포지토리 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-11.4.2 | 측정 데이터 관리를 위한 REST API 제공 | 권장 | 4 | ✅ 구현됨 |

---

### FR-12: 모니터링 및 관찰성

#### FR-12.1: 데이터베이스 모니터링
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-12.1.1 | 성능 모니터링을 위한 데이터베이스 메트릭 서비스 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-12.1.2 | 데이터베이스 메트릭 접근을 위한 REST API 제공 | 권장 | 4 | ✅ 구현됨 |

#### FR-12.2: DICOM 메트릭 수집기
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-12.2.1 | 연결 라이프사이클 메트릭 수집기 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-12.2.2 | DIMSE 연산 메트릭 수집기 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-12.2.3 | 저장 및 전송 메트릭 수집기 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-12.2.4 | Prometheus 텍스트 노출 형식 지원 | 권장 | 4 | ✅ 구현됨 |
| FR-12.2.5 | REST API 통합을 위한 JSON 내보내기 지원 | 권장 | 4 | ✅ 구현됨 |

#### FR-12.3: 오브젝트 풀 메모리 관리
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-12.3.1 | dicom_element, dicom_dataset, PDU 버퍼를 위한 오브젝트 풀링 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-12.3.2 | RAII 기반 자동 풀 반환 제공 | 권장 | 4 | ✅ 구현됨 |
| FR-12.3.3 | 풀 적중률 모니터링 및 통계 지원 | 권장 | 4 | ✅ 구현됨 |

#### FR-12.4: 상태 확인
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-12.4.1 | 상태, 준비, 생존 프로브 엔드포인트 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-12.4.2 | 사용자 정의 상태 확인 등록 지원 | 권장 | 4 | ✅ 구현됨 |

#### FR-12.5: 썸네일 및 메타데이터 서비스
| ID | 요구사항 | 우선순위 | 단계 | 상태 |
|----|----------|----------|------|------|
| FR-12.5.1 | 이미지 썸네일 생성 서비스 구현 | 권장 | 4 | ✅ 구현됨 |
| FR-12.5.2 | 효율적인 DICOM 속성 접근을 위한 메타데이터 조회 서비스 구현 | 권장 | 4 | ✅ 구현됨 |

---

## 비기능 요구사항

### NFR-1: 성능

| ID | 요구사항 | 목표 | 측정 방법 |
|----|----------|------|----------|
| NFR-1.1 | 이미지 저장 처리량 | ≥100 MB/s | 지속 C-STORE 속도 |
| NFR-1.2 | 동시 연결 수 | ≥100 | 동시 연결 수 |
| NFR-1.3 | 조회 응답 시간 (P95) | <100 ms | C-FIND 응답 지연 |
| NFR-1.4 | 연결 설정 | <50 ms | A-ASSOCIATE 왕복 시간 |
| NFR-1.5 | 기본 메모리 사용량 | <500 MB | 유휴 서버 메모리 |
| NFR-1.6 | 연결당 메모리 | <10 MB | 연결별 오버헤드 |

### NFR-2: 안정성

| ID | 요구사항 | 목표 | 측정 방법 |
|----|----------|------|----------|
| NFR-2.1 | 시스템 가동 시간 | 99.9% | 월간 가용성 |
| NFR-2.2 | 데이터 무결성 | 100% | 데이터 손상 제로 |
| NFR-2.3 | 점진적 성능 저하 | 필수 | 고부하 상황에서 |
| NFR-2.4 | 오류 복구 | 자동 | 연결 실패 시 |
| NFR-2.5 | 트랜잭션 안전성 | ACID | 파일 연산 |

### NFR-3: 확장성

| ID | 요구사항 | 목표 | 측정 방법 |
|----|----------|------|----------|
| NFR-3.1 | 수평 확장 | 지원 | 다중 인스턴스 |
| NFR-3.2 | 이미지 용량 | ≥1M 스터디 | 저장 인스턴스당 |
| NFR-3.3 | 선형 처리량 확장 | ≥80% 효율 | 추가 워커 시 |
| NFR-3.4 | 큐 용량 | ≥10K 작업 | 대기 중인 연산 |

### NFR-4: 보안

| ID | 요구사항 | 목표 | 측정 방법 |
|----|----------|------|----------|
| NFR-4.1 | TLS 지원 | TLS 1.2/1.3 | DICOM TLS |
| NFR-4.2 | 접근 로깅 | 완전함 | 모든 DICOM 연산 |
| NFR-4.3 | 감사 추적 | HIPAA 준수 | PHI 접근 |
| NFR-4.4 | 입력 검증 | 100% | 모든 네트워크 입력 |
| NFR-4.5 | 메모리 안전성 | 누수 제로 | AddressSanitizer 클린 |

### NFR-5: 유지보수성

| ID | 요구사항 | 목표 | 측정 방법 |
|----|----------|------|----------|
| NFR-5.1 | 코드 커버리지 | ≥80% | 라인 커버리지 |
| NFR-5.2 | 문서화 | 완전함 | 모든 공개 API |
| NFR-5.3 | CI/CD 파이프라인 | 100% 그린 | 모든 플랫폼 |
| NFR-5.4 | 스레드 안전성 | 검증됨 | ThreadSanitizer 클린 |
| NFR-5.5 | 모듈러 설계 | 낮은 결합도 | 인터페이스 중심 |

---

## 시스템 아키텍처 요구사항

### SAR-1: 모듈 의존성

```
┌──────────────────────────────────────────────────────────────────────────┐
│                              pacs_system                                  │
├──────────────────────────────────────────────────────────────────────────┤
│  ┌───────────┐  ┌──────────┐  ┌──────────┐  ┌────────────┐  ┌────────┐ │
│  │    web    │  │  client  │  │    ai    │  │  workflow  │  │security│ │
│  │           │  │          │  │          │  │            │  │        │ │
│  │ REST API  │  │ Job Mgr  │  │ AI Svc   │  │ Prefetch   │  │ RBAC   │ │
│  │ DICOMweb  │  │ Routing  │  │ AI Rslt  │  │ Scheduler  │  │ Anonym │ │
│  │ 19 Endpts │  │ Sync Mgr │  │ Handler  │  │ Study Lock │  │ DigSig │ │
│  │           │  │ Prefetch │  │          │  │            │  │        │ │
│  │           │  │ RemoteNd │  │          │  │            │  │        │ │
│  └─────┬─────┘  └────┬─────┘  └────┬─────┘  └─────┬──────┘  └───┬────┘ │
│        │              │             │              │             │      │
│  ┌─────▼──────────────▼─────────────▼──────────────▼─────────────▼────┐ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌────────────────────────┐    │ │
│  │  │   services   │  │   network    │  │       storage          │    │ │
│  │  │              │  │              │  │                        │    │ │
│  │  │ Storage SCP  │  │ PDU Layer    │  │ File Storage           │    │ │
│  │  │ Q/R SCP      │◄─│ DIMSE Layer  │◄─│ Index Database         │    │ │
│  │  │ MWL SCP      │  │ Association  │  │ Cloud Storage (S3/Az)  │    │ │
│  │  │ MPPS SCP     │  │ Server V2    │  │ HSM Storage            │    │ │
│  │  │ Monitoring   │  │              │  │ Annotation/Viewer/Key  │    │ │
│  │  └──────┬───────┘  └──────┬───────┘  └───────────┬────────────┘    │ │
│  └─────────┼─────────────────┼──────────────────────┼─────────────────┘ │
│  ┌─────────▼─────────────────▼──────────────────────▼─────────────────┐ │
│  │                         core                                        │ │
│  │  dicom_element | dicom_dataset | dicom_file | dictionary | pool_mgr│ │
│  └─────────────────────────┬───────────────────────────────────────────┘ │
│                            │                                             │
│  ┌─────────────────────────▼───────────────────────────────────────────┐ │
│  │                      encoding                                        │ │
│  │  vr_types | transfer_syntax | implicit_vr | explicit_vr | SIMD      │ │
│  │  JPEG | JPEG2K | JPEG-LS | RLE | compression codecs                 │ │
│  └─────────────────────────┬───────────────────────────────────────────┘ │
│                            │                                             │
│  ┌─────────────────────────▼───────────────────────────────────────────┐ │
│  │                     integration                                      │ │
│  │  container_adapter | network_adapter | thread_adapter | itk_adapter │ │
│  │  logger_adapter | monitoring_adapter | executor_adapter              │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────────────┘
                                │
        ┌───────────────────────┼───────────────────────┐
        │                       │                       │
┌───────▼───────┐    ┌──────────▼──────────┐    ┌───────▼───────┐
│network_system │    │   thread_system     │    │container_system│
│  (TCP/TLS)    │    │  (Thread Pool)      │    │(Serialization) │
└───────────────┘    └────────────────────┘    └───────────────┘
        │                       │                       │
        └───────────────────────┼───────────────────────┘
                                │
        ┌───────────────────────┼───────────────────────┐
        │                       │                       │
┌───────▼───────┐    ┌──────────▼──────────┐    ┌───────▼───────┐
│ logger_system │    │ monitoring_system   │    │ common_system │
│   (Logging)   │    │    (Metrics)        │    │ (Foundation)  │
└───────────────┘    └────────────────────┘    └───────────────┘
```

### SAR-2: 컴포넌트 인터페이스 요구사항

| 컴포넌트 | 인터페이스 유형 | 설명 |
|----------|----------------|------|
| Storage Backend | 추상 인터페이스 | 교체 가능한 저장 구현체 |
| Association Handler | 옵저버 패턴 | 이벤트 기반 연결 라이프사이클 |
| DIMSE Processor | 전략 패턴 | 교체 가능한 메시지 핸들러 |
| PDU Codec | 템플릿 인터페이스 | 타입 안전 인코딩/디코딩 |
| Service Provider | 팩토리 패턴 | 동적 서비스 인스턴스화 |

### SAR-3: 스레드 모델 요구사항

| 요구사항 | 설명 |
|----------|------|
| Main IO Thread | 네트워크 연산을 위한 ASIO 이벤트 루프 |
| Worker Pool | DIMSE 메시지 처리를 위한 스레드 풀 |
| Storage Workers | 파일 I/O를 위한 전용 스레드 |
| Query Workers | 데이터베이스 조회를 위한 별도 풀 |
| Lock-free Queues | 스레드 간 통신 |

---

## DICOM 적합성 요구사항

### DCR-1: SOP 클래스 지원

#### 1단계 (MVP) - 검증
| SOP 클래스 | UID | 역할 |
|-----------|-----|------|
| Verification | 1.2.840.10008.1.1 | SCP/SCU |

#### 2단계 - 저장
| SOP 클래스 | UID | 역할 | 상태 |
|-----------|-----|------|------|
| CT Image Storage | 1.2.840.10008.5.1.4.1.1.2 | SCP/SCU | ✅ 구현됨 |
| MR Image Storage | 1.2.840.10008.5.1.4.1.1.4 | SCP/SCU | ✅ 구현됨 |
| CR Image Storage | 1.2.840.10008.5.1.4.1.1.1 | SCP/SCU | ✅ 구현됨 |
| Digital X-Ray | 1.2.840.10008.5.1.4.1.1.1.1 | SCP/SCU | ✅ 구현됨 |
| Secondary Capture | 1.2.840.10008.5.1.4.1.1.7 | SCP/SCU | ✅ 구현됨 |
| Ultrasound Image Storage | 1.2.840.10008.5.1.4.1.1.6.1 | SCP/SCU | ✅ 구현됨 |
| Ultrasound Multi-frame | 1.2.840.10008.5.1.4.1.1.6.2 | SCP/SCU | ✅ 구현됨 |
| XA Image Storage | 1.2.840.10008.5.1.4.1.1.12.1 | SCP/SCU | ✅ 구현됨 |
| Enhanced XA Image Storage | 1.2.840.10008.5.1.4.1.1.12.1.1 | SCP/SCU | ✅ 구현됨 |
| XRF Image Storage | 1.2.840.10008.5.1.4.1.1.12.2 | SCP/SCU | ✅ 구현됨 |
| NM Image Storage | 1.2.840.10008.5.1.4.1.1.20 | SCP/SCU | ✅ 구현됨 |
| PET Image Storage | 1.2.840.10008.5.1.4.1.1.128 | SCP/SCU | ✅ 구현됨 |
| Enhanced PET Image Storage | 1.2.840.10008.5.1.4.1.1.130 | SCP/SCU | ✅ 구현됨 |
| RT Plan Storage | 1.2.840.10008.5.1.4.1.1.481.5 | SCP/SCU | ✅ 구현됨 |
| RT Dose Storage | 1.2.840.10008.5.1.4.1.1.481.2 | SCP/SCU | ✅ 구현됨 |
| RT Structure Set Storage | 1.2.840.10008.5.1.4.1.1.481.3 | SCP/SCU | ✅ 구현됨 |
| RT Image Storage | 1.2.840.10008.5.1.4.1.1.481.1 | SCP/SCU | ✅ 구현됨 |
| Segmentation Storage | 1.2.840.10008.5.1.4.1.1.66.4 | SCP/SCU | ✅ 구현됨 |
| Basic Text SR Storage | 1.2.840.10008.5.1.4.1.1.88.11 | SCP/SCU | ✅ 구현됨 |
| Enhanced SR Storage | 1.2.840.10008.5.1.4.1.1.88.22 | SCP/SCU | ✅ 구현됨 |
| Comprehensive SR Storage | 1.2.840.10008.5.1.4.1.1.88.33 | SCP/SCU | ✅ 구현됨 |
| Key Object Selection Document | 1.2.840.10008.5.1.4.1.1.88.59 | SCP/SCU | ✅ 구현됨 |
| Mammography CAD SR Storage | 1.2.840.10008.5.1.4.1.1.88.50 | SCP/SCU | ✅ 구현됨 |

#### 3단계 - 조회/검색
| SOP 클래스 | UID | 역할 |
|-----------|-----|------|
| Patient Root Q/R Find | 1.2.840.10008.5.1.4.1.2.1.1 | SCP/SCU |
| Patient Root Q/R Move | 1.2.840.10008.5.1.4.1.2.1.2 | SCP/SCU |
| Patient Root Q/R Get | 1.2.840.10008.5.1.4.1.2.1.3 | SCP/SCU |
| Study Root Q/R Find | 1.2.840.10008.5.1.4.1.2.2.1 | SCP/SCU |
| Study Root Q/R Move | 1.2.840.10008.5.1.4.1.2.2.2 | SCP/SCU |
| Study Root Q/R Get | 1.2.840.10008.5.1.4.1.2.2.3 | SCP/SCU |

#### 4단계 - 워크플로우
| SOP 클래스 | UID | 역할 |
|-----------|-----|------|
| Modality Worklist | 1.2.840.10008.5.1.4.31 | SCP |
| MPPS | 1.2.840.10008.3.1.2.3.3 | SCP |

### DCR-2: Transfer Syntax 지원

| Transfer Syntax | UID | 우선순위 | 상태 |
|-----------------|-----|----------|------|
| Implicit VR Little Endian | 1.2.840.10008.1.2 | 필수 | ✅ 구현됨 |
| Explicit VR Little Endian | 1.2.840.10008.1.2.1 | 필수 | ✅ 구현됨 |
| Explicit VR Big Endian | 1.2.840.10008.1.2.2 | 선택 | ✅ 구현됨 |
| JPEG Baseline | 1.2.840.10008.1.2.4.50 | 선택 | ✅ 구현됨 |
| JPEG Lossless | 1.2.840.10008.1.2.4.70 | 선택 | ✅ 구현됨 |
| JPEG 2000 Lossless | 1.2.840.10008.1.2.4.90 | 선택 | ✅ 구현됨 |
| JPEG 2000 | 1.2.840.10008.1.2.4.91 | 선택 | ✅ 구현됨 |
| JPEG-LS Lossless | 1.2.840.10008.1.2.4.80 | 선택 | ✅ 구현됨 |
| JPEG-LS Near-Lossless | 1.2.840.10008.1.2.4.81 | 선택 | ✅ 구현됨 |
| RLE Lossless | 1.2.840.10008.1.2.5 | 선택 | ✅ 구현됨 |

---

## 통합 요구사항

### IR-1: 에코시스템 통합

| 시스템 | 통합 유형 | 용도 | 상태 |
|--------|----------|------|------|
| **common_system** | 기반 | Result<T>, 오류 코드, IExecutor | ✅ 통합됨 |
| **container_system** | 데이터 레이어 | DICOM 값 직렬화 | ✅ 통합됨 |
| **thread_system** | 동시성 | 워커 풀, 비동기 처리, jthread 지원, cancellation_token | ✅ 완전 마이그레이션 (v1.1.0) |
| **logger_system** | 로깅 | 감사 로그, 진단 | ✅ 통합됨 |
| **monitoring_system** | 관찰성 | 메트릭, 상태 확인 | ✅ 통합됨 |
| **network_system** | 네트워크 | TCP/TLS, 세션 관리, messaging_server | ✅ V2 구현 (선택적) |

#### 스레드 시스템 마이그레이션 (2025-12-07 완료)

시스템이 직접적인 `std::thread` 사용에서 `thread_system`으로 완전히 마이그레이션되었습니다:

| 컴포넌트 | 이전 | 현재 | 장점 |
|----------|------|------|------|
| Accept 루프 | `std::thread accept_thread_` | `accept_worker` (`thread_base` 상속) | jthread, cancellation_token |
| 워커 스레드 | 연결별 `std::thread` | `thread_adapter` 풀 | 통합 모니터링, 로드 밸런싱 |
| 종료 | 수동 스레드 관리 | 협력적 취소 | 45배 빠른 graceful shutdown |
| 통계 | 없음 | 통합 스레드 통계 | 완전한 관찰성 |

#### Network System V2 (선택적)

`network_system::messaging_server`를 사용하는 선택적 V2 구현이 제공됩니다:

| 컴포넌트 | 용도 |
|----------|------|
| `dicom_server_v2` | TCP 연결 관리에 `messaging_server` 사용 |
| `dicom_association_handler` | PDU 프레이밍, 상태 머신, 서비스 디스패칭 |
| 컴파일 플래그 | `PACS_WITH_NETWORK_SYSTEM` |

### IR-2: 외부 시스템 통합

| 시스템 | 프로토콜 | 용도 | 상태 |
|--------|----------|------|------|
| DICOMweb | WADO-RS/STOW-RS/QIDO-RS | 웹 이미지 접근 (PS3.18) | ✅ 구현됨 |
| AI 서비스 | REST/HTTP | 외부 AI 추론 엔드포인트 | ✅ 구현됨 |
| HIS/RIS | HL7 FHIR | 환자 인구통계 | 향후 |

---

## 보안 요구사항

### SR-1: 데이터 보호

| 요구사항 | 구현 |
|----------|------|
| PHI 암호화 | 네트워크용 TLS 1.2+, 저장소용 AES |
| 접근 제어 | AE Title 화이트리스팅, 사용자 인증 |
| 감사 로깅 | 모든 DICOM 연산의 타임스탬프 포함 로깅 |
| 데이터 무결성 | 저장된 이미지의 체크섬 검증 |

### SR-2: 준수 사항

| 표준 | 요구사항 |
|------|----------|
| HIPAA | PHI 접근 로깅, 저장/전송 시 암호화 |
| GDPR | 정보 주체 접근권, 감사 추적 |
| IHE | ATNA (감사 추적 및 노드 인증) |

---

## 성능 요구사항

### PR-1: 벤치마크

| 메트릭 | 목표 | 측정값 | 상태 | 테스트 시나리오 |
|--------|------|--------|------|----------------|
| C-STORE 처리량 | ≥100 MB/s | 9,247 MB/s | ✅ 통과 | 512KB 이미지 |
| C-ECHO 처리량 | ≥100 msg/s | 89,964 msg/s | ✅ 통과 | 지속 트래픽 |
| 연결 지연시간 | <100 ms | ~1 ms | ✅ 통과 | 협상 포함 |
| Graceful 종료 | <5,000 ms | 110 ms | ✅ 통과 | 활성 연결 포함 |
| 연결당 메모리 | <10 MB | ~5 MB | ✅ 통과 | 활성 연결 |

*성능은 thread_system 마이그레이션 후 측정됨 (2025-12-07). 상세 내용은 [PERFORMANCE_RESULTS.md](PERFORMANCE_RESULTS.md) 참조.*

### PR-2: 확장성 목표

| 메트릭 | 목표 | 측정값 | 상태 |
|--------|------|--------|------|
| 동시 연결 | 100+ | 200+ | ✅ 초과 |
| 동시 C-ECHO 작업 | >50 ops/s | 124 ops/s | ✅ 초과 |
| 동시 C-STORE 작업 | >10 ops/s | 49.6 ops/s | ✅ 초과 |
| 스터디 데이터베이스 크기 | 1M+ 스터디 | 100K 테스트됨 | ✅ 진행 중 |
| 일일 수집량 | 50K+ 이미지 | 아키텍처 검증됨 | ✅ 검증됨 |

---

## 개발 단계

### 1단계: 기반 구축 (1-4주차)

**목표**: 핵심 DICOM 데이터 처리 수립

| 산출물 | 설명 | 수락 기준 |
|--------|------|----------|
| DICOM Element | 데이터 요소 파서/인코더 | 표준 VR 100% 파싱 |
| Data Set | 데이터 세트 컨테이너 | 모든 CRUD 연산 |
| DICOM File | Part 10 파일 리더/라이터 | DICOM 파일 읽기/쓰기 |
| Tag Dictionary | 표준 태그 정의 | 모든 PS3.6 태그 정의 |
| Unit Tests | 코어 모듈 테스트 | 80%+ 커버리지 |

**의존성**: container_system, common_system

### 2단계: 네트워크 프로토콜 (5-10주차)

**목표**: DICOM 상위 레이어 및 기본 DIMSE 구현

| 산출물 | 설명 | 수락 기준 |
|--------|------|----------|
| PDU Layer | 모든 PDU 타입 | 모든 PDU 인코드/디코드 |
| Association | 상태 머신, 협상 | 연결 테스트 통과 |
| C-ECHO | 검증 서비스 | DCMTK와 상호운용 |
| C-STORE | 기본 저장 | 모달리티에서 이미지 저장 |
| Integration Tests | 네트워크 테스트 | 모든 시나리오 통과 |

**의존성**: network_system, thread_system

### 3단계: 핵심 서비스 (11-16주차)

**목표**: 저장 및 조회/검색 구현

| 산출물 | 설명 | 수락 기준 |
|--------|------|----------|
| Storage SCP | 전체 저장 서비스 | CT/MR/CR 이미지 저장 |
| File Storage | 파일시스템 백엔드 | 계층적 저장 |
| Index DB | 조회 인덱스 | 빠른 속성 조회 |
| C-FIND | 조회 서비스 | 환자/스터디/시리즈/이미지 |
| C-MOVE | 검색 서비스 | 이미지 전송 |
| Conformance | 초기 테스트 | 기본 적합성 통과 |

**의존성**: 모든 시스템

### 4단계: 고급 서비스 및 운영 환경 강화 (17-24주차)

**목표**: 워크플로우 서비스, 웹 API, AI 통합, 클라이언트 모듈 추가 및 운영 환경 강화

| 산출물 | 설명 | 수락 기준 | 상태 |
|--------|------|----------|------|
| Worklist SCP/SCU | MWL 서비스 | 예약된 절차 조회 | ✅ 완료 |
| MPPS SCP/SCU | 절차 추적 | 절차 상태 추적 | ✅ 완료 |
| C-GET | 대체 검색 | C-GET 모델 지원 | ✅ 완료 |
| TLS | 보안 통신 | DICOM TLS 적합 | ✅ 완료 |
| REST API 서버 | Crow 기반 웹 서버 | 19개 엔드포인트 모듈 | ✅ 완료 |
| DICOMweb | WADO-RS, STOW-RS, QIDO-RS | PS3.18 적합 | ✅ 완료 |
| AI 통합 | AI 서비스 커넥터 + 결과 핸들러 | 외부 AI 추론 | ✅ 완료 |
| 클라이언트 모듈 | Job, Routing, Sync, Prefetch, Remote Node | 다중 노드 연합 | ✅ 완료 |
| 클라우드 스토리지 | S3 + Azure Blob (Mock) + HSM | 3단계 저장소 | ✅ 완료 |
| 보안 | RBAC, 익명화, 전자 서명 | PS3.15 적합 | ✅ 완료 |
| 워크플로우 | 자동 프리페치, 태스크 스케줄러, 스터디 잠금 | 자동화 운영 | ✅ 완료 |
| 모니터링 | DICOM 메트릭, 오브젝트 풀, 상태 확인 | 운영 관찰성 | ✅ 완료 |
| 주석/뷰어 | 주석, 뷰어 상태, 키 이미지, 측정 | 임상 데이터 관리 | ✅ 완료 |

**의존성**: 모든 시스템

### 5단계: 엔터프라이즈 기능 (향후)

**목표**: 운영 클라우드 통합, 고급 상호운용성 및 엔터프라이즈 기능

| 산출물 | 설명 | 수락 기준 |
|--------|------|----------|
| 전체 AWS S3 SDK | 운영 S3 통합 | Mock 구현 대체 |
| 전체 Azure SDK | 운영 Azure Blob 통합 | Mock 구현 대체 |
| ITK/VTK 통합 | 고급 영상 처리 및 3D 재구성 | 영상 분석 파이프라인 |
| FHIR 통합 | HL7 FHIR 상호운용성 | 의료 데이터 교환 |
| 클러스터링 | 다중 노드 PACS 배포 | 수평 확장 |
| 연결 풀링 | DICOM 연결 재사용 | 지연시간 단축 |

**의존성**: 모든 시스템

---

## 성공 지표

### 기술 지표

| 지표 | 목표 | 측정 방법 |
|------|------|----------|
| DICOM 적합성 | 테스트된 SOP 클래스 100% | 적합성 테스트 스위트 |
| 코드 커버리지 | ≥80% | CI 커버리지 리포트 |
| CI/CD 성공률 | 100% 그린 | GitHub Actions |
| 새니타이저 클린 | 이슈 제로 | TSAN/ASAN/UBSAN |
| API 문서화 | 공개 API 100% | Doxygen 생성 |

### 성능 지표

| 지표 | 목표 | 측정 방법 |
|------|------|----------|
| 저장 처리량 | ≥100 MB/s | 벤치마크 스위트 |
| 조회 지연 P95 | <100 ms | 부하 테스트 |
| 기본 메모리 | <500 MB | 프로파일링 |
| 동시 연결 | 100+ | 스트레스 테스트 |

### 품질 지표

| 지표 | 목표 | 측정 방법 |
|------|------|----------|
| RAII 등급 | A | 정적 분석 |
| 스레드 안전성 | 검증됨 | ThreadSanitizer |
| 메모리 안전성 | 누수 제로 | AddressSanitizer |
| 정적 분석 | 경고 제로 | clang-tidy, cppcheck |

---

## 위험 및 완화 방안

### 기술적 위험

| 위험 | 영향 | 확률 | 완화 방안 |
|------|------|------|----------|
| DICOM 복잡성 과소평가 | 높음 | 중간 | MVP 접근, 점진적 전달 |
| 성능 목표 미달성 | 중간 | 낮음 | 에코시스템 최적화 활용 |
| 상호운용성 문제 | 높음 | 중간 | 조기 적합성 테스트 |
| 이미지 압축 복잡성 | 중간 | 높음 | 향후 단계로 연기 |

### 자원 위험

| 위험 | 영향 | 확률 | 완화 방안 |
|------|------|------|----------|
| 개발 시간 연장 | 중간 | 중간 | 명확한 단계 경계 |
| 범위 확대 | 중간 | 중간 | 엄격한 우선순위 관리 |
| 테스트 인프라 | 낮음 | 낮음 | 에코시스템 패턴 재사용 |

### 외부 위험

| 위험 | 영향 | 확률 | 완화 방안 |
|------|------|------|----------|
| DICOM 표준 업데이트 | 낮음 | 낮음 | 업데이트용 모듈러 설계 |
| 의존성 취약점 | 중간 | 낮음 | 정기 보안 스캔 |

---

## 부록

### 부록 A: DICOM VR 타입 매핑

| VR | 전체 이름 | container_system 타입 | 크기 |
|----|----------|----------------------|------|
| AE | Application Entity | string | 최대 16 |
| AS | Age String | string | 고정 4 |
| AT | Attribute Tag | uint32 | 4 |
| CS | Code String | string | 최대 16 |
| DA | Date | string | 고정 8 |
| DS | Decimal String | string → double | 최대 16 |
| DT | Date Time | string | 최대 26 |
| FL | Floating Point Single | float | 4 |
| FD | Floating Point Double | double | 8 |
| IS | Integer String | string → int64 | 최대 12 |
| LO | Long String | string | 최대 64 |
| LT | Long Text | string | 최대 10240 |
| OB | Other Byte | bytes | 가변 |
| OD | Other Double | bytes | 가변 |
| OF | Other Float | bytes | 가변 |
| OL | Other Long | bytes | 가변 |
| OW | Other Word | bytes | 가변 |
| PN | Person Name | string | 최대 64 |
| SH | Short String | string | 최대 16 |
| SL | Signed Long | int32 | 4 |
| SQ | Sequence | container (중첩) | 가변 |
| SS | Signed Short | int16 | 2 |
| ST | Short Text | string | 최대 1024 |
| TM | Time | string | 최대 14 |
| UC | Unlimited Characters | string | 무제한 |
| UI | Unique Identifier | string | 최대 64 |
| UL | Unsigned Long | uint32 | 4 |
| UN | Unknown | bytes | 가변 |
| UR | Universal Resource Identifier | string | 무제한 |
| US | Unsigned Short | uint16 | 2 |
| UT | Unlimited Text | string | 무제한 |
| OV | Other 64-bit Very Long | bytes | 가변 |
| SV | Signed 64-bit Very Long | int64 | 8 |
| UV | Unsigned 64-bit Very Long | uint64 | 8 |

### 부록 B: 오류 코드 레지스트리

```
pacs_system 오류 코드: -700 ~ -899

DICOM 파일 오류 (-700 ~ -719):
  -700: INVALID_DICOM_FILE
  -701: MISSING_DICM_PREFIX
  -702: INVALID_META_INFO
  -703: FILE_READ_ERROR
  -704: FILE_WRITE_ERROR

DICOM 요소 오류 (-720 ~ -739):
  -720: INVALID_DATA_ELEMENT
  -721: ELEMENT_NOT_FOUND
  -722: INVALID_VALUE_CONVERSION
  -723: MISSING_REQUIRED_TAG

인코딩 오류 (-740 ~ -759):
  -740: INVALID_VR
  -741: INVALID_TRANSFER_SYNTAX
  -742: SEQUENCE_ENCODING_ERROR
  -743: COMPRESSION_ERROR
  -744: DECOMPRESSION_ERROR

네트워크 오류 (-760 ~ -779):
  -760: ASSOCIATION_REJECTED
  -761: ASSOCIATION_ABORTED
  -762: NO_PRESENTATION_CONTEXT
  -763: INVALID_PDU
  -764: PDU_TOO_LARGE
  -765: ASSOCIATION_TIMEOUT
  -766: DIMSE_FAILURE
  -767: DIMSE_TIMEOUT
  -768: DIMSE_INVALID_RESPONSE
  -769: DIMSE_CANCELLED

저장 오류 (-780 ~ -799):
  -780: STORAGE_FAILED
  -781: DUPLICATE_SOP_INSTANCE
  -782: INVALID_SOP_CLASS
  -783: STORAGE_FULL
  -784: QUERY_FAILED
  -785: NO_MATCHES_FOUND
  -786: TOO_MANY_MATCHES
  -787: INVALID_QUERY_LEVEL
  -788: DATABASE_ERROR

서비스 오류 (-800 ~ -899):
  -800: C-STORE 서비스 오류 (-800 ~ -819)
  -820: C-FIND 서비스 오류 (-820 ~ -839)
  -840: C-MOVE/C-GET 서비스 오류 (-840 ~ -859)
  -860: Verification 서비스 오류 (-860 ~ -869)
  -870: MPPS 서비스 오류 (-870 ~ -879)
  -880: Worklist 서비스 오류 (-880 ~ -889)
  -890: 일반 서비스 오류 (-890 ~ -899)
```

### 부록 C: 참고 자료

- DICOM 표준: https://www.dicomstandard.org/
- PS3.5 - 데이터 구조 및 인코딩
- PS3.6 - 데이터 딕셔너리
- PS3.7 - 메시지 교환
- PS3.8 - 네트워크 통신 지원
- PS3.4 - 서비스 클래스 사양

---

## 문서 이력

| 버전 | 날짜 | 작성자 | 변경 사항 |
|------|------|--------|----------|
| 1.0.0 | 2025-11-30 | kcenon@naver.com | 초기 PRD 릴리스 |
| 1.1.0 | 2025-12-07 | kcenon@naver.com | 완료된 기능 업데이트: 스레드 시스템 마이그레이션 (Epic #153), DIMSE-N 서비스 (#127), Ultrasound/XA 저장 (#128, #129), Explicit VR Big Endian (#126), 성능 결과 |
| 2.0.0 | 2026-02-08 | raphaelshin | 주요 업데이트: PRD에 15개 이상 구현된 기능 추가. 신규 섹션: FR-10 (클라이언트 모듈), FR-11 (주석/뷰어 상태/임상 데이터), FR-12 (모니터링/관찰성). FR-3.4 (워크리스트), FR-3.5 (MPPS), FR-5 (보안), FR-6 (웹 API - 19개 엔드포인트), FR-7 (워크플로우 - 3개 서비스), FR-8 (클라우드 스토리지 + HSM), FR-9 (AI 통합) 상태 업데이트. 아키텍처 다이어그램 및 개발 단계 업데이트. 이미 구현된 5단계 항목을 4단계로 재분류. |

---

*문서 버전: 0.2.0.0*
*작성일: 2025-11-30*
*수정일: 2026-02-08*
*작성자: kcenon@naver.com*
